import { describe, test } from 'node:test';
import assert from 'node:assert/strict';
import { accuracy } from '../src/local/accuracy';

describe('accuracy', () => {
  test('real game', () => {
    assert.deepEqual(
      accuracy(game1.evals.map((ev, i) => ({ ply: i, eval: ev }) as Tree.Node)),
      game1.accuracy,
    );
  });
});

const game1 = {
  accuracy: { white: { percent: 88, acpl: 26 }, black: { percent: 78, acpl: 50 } },
  evals: [
    { cp: 31 },
    { cp: 31 },
    { cp: 22 },
    { cp: 25 },
    { cp: 25 },
    { cp: 29 },
    { cp: 27 },
    { cp: 0 },
    { cp: 2 },
    { cp: 15 },
    { cp: 1 },
    { cp: -11 },
    { cp: 15 },
    { cp: 5 },
    { cp: 37 },
    { cp: 39 },
    { cp: 87 },
    { cp: 5 },
    { cp: 5 },
    { cp: -6 },
    { cp: 21 },
    { cp: -28 },
    { cp: -6 },
    { cp: -17 },
    { cp: -25 },
    { cp: -10 },
    { cp: -11 },
    { cp: -11 },
    { cp: -12 },
    { cp: -33 },
    { cp: 15 },
    { cp: 10 },
    { cp: 283 },
    { cp: -31 },
    { cp: -11 },
    { cp: -95 },
    { cp: -98 },
    { cp: -78 },
    { cp: -66 },
    { cp: -131 },
    { cp: -124 },
    { cp: -173 },
    { cp: -18 },
    { cp: -25 },
    { cp: 45 },
    { cp: 34 },
    { cp: 97 },
    { cp: 0 },
    { cp: 0 },
    { cp: 5 },
    { cp: 7 },
    { cp: 2 },
    { cp: 51 },
    { cp: 0 },
    { cp: 0 },
    { cp: -8 },
    { cp: 0 },
    { cp: 0 },
    { cp: 0 },
    { cp: 0 },
    { cp: 0 },
    { cp: 0 },
    { cp: 0 },
    { cp: -37 },
    { cp: -33 },
    { cp: -27 },
    { cp: -24 },
    { cp: -28 },
    { cp: -31 },
    { cp: -30 },
    { cp: -5 },
    { cp: -37 },
    { cp: -17 },
    { cp: -24 },
    { cp: 3000 },
    { cp: 2000 },
    { cp: 2000 },
    { cp: 1000 },
    { cp: 1000 },
  ],
};
