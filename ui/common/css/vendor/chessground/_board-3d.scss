$td-outer-height-ratio: 476 / 512;
$td-outer-height-percent: $td-outer-height-ratio * 100%;
$td-inner-height-ratio: 464.5 / 512;
$td-inner-relative-percent: $td-inner-height-ratio / $td-outer-height-ratio * 100%;

@include breakpoint($mq-col1-uniboard) {
  .is3d {
    /* horiz scroll caused by 3d pieces overflowing the board */
    overflow-x: clip;
  }
}

.main-board {
  padding-bottom: $td-outer-height-percent;

  .cg-wrap {
    height: $td-inner-relative-percent;
  }
}

piece {
  /* original size: width: 140.625%; height: 179.6875%; */
  /* size on 3D board, with height/width = 90.78571% */
  width: 16.741%;
  height: 23.563%;
  left: -1.85%;
  top: -9.1%;
}

.is2d piece {
  /* copy of board.css to override miniboards */
  left: 0;
  top: 0;
  width: 12.5%;
  height: 12.5%;
}

cg-board::before {
  position: absolute;
  top: -0.730688%;
  left: 0;
  width: 100%;
  height: 103.2%;
  content: '';
  background-size: cover;
}

.is2d {
  /* override miniboards */
  cg-board {
    top: 0;
    height: 100%;

    &::before {
      content: none;
    }
  }
}

$board-themes: (
  'Black-White-Aluminium': (
    coord-color-white: #d9ded9,
    coord-color-black: #4c4e4d,
  ),
  'Brushed-Aluminium': (
    coord-color-white: #5c5e63,
    coord-color-black: #46494f,
  ),
  'China-Blue': (
    coord-color-white: #e7e8cc,
    coord-color-black: #3c00ba,
  ),
  'China-Green': (
    coord-color-white: #e7e8cc,
    coord-color-black: #48b064,
  ),
  'China-Grey': (
    coord-color-white: #e4e4ca,
    coord-color-black: #6a6b68,
  ),
  'China-Scarlet': (
    coord-color-white: #e7e8cc,
    coord-color-black: #ac161d,
  ),
  'China-Yellow': (
    coord-color-white: #e7e8cc,
    coord-color-black: #c8dd1c,
  ),
  'Classic-Blue': (
    coord-color-white: #7193df,
    coord-color-black: #5178a7,
  ),
  'Gold-Silver': (
    coord-color-white: #c0c3c8,
    coord-color-black: #514d1d,
  ),
  'Green-Glass': (
    coord-color-white: #f7fafa,
    coord-color-black: #a1ffb4,
  ),
  'Light-Wood': (
    coord-color-white: #dacc9f,
    coord-color-black: #ac7231,
  ),
  'Power-Coated': (
    coord-color-white: #d5dad4,
    coord-color-black: #939697,
  ),
  'Purple-Black': (
    coord-color-white: #bd00ac,
    coord-color-black: #3e4042,
  ),
  'Rosewood': (
    coord-color-white: #fae7df,
    coord-color-black: #d68170,
  ),
  'Wood-Glass': (
    coord-color-white: #dbdae7,
    coord-color-black: #e4c384,
  ),
  'Marble': (
    coord-color-white: #5a9475,
    coord-color-black: #265e41,
  ),
  'Wax': (
    coord-color-white: #dbba8e,
    coord-color-black: #d25563,
  ),
  'Jade': (
    coord-color-white: #9b9591,
    coord-color-black: #134e35,
  ),
  'Woodi': (
    coord-color-white: #80713c,
    coord-color-black: #62521a,
  ),
);

@each $name, $theme in $board-themes {
  .#{$name} .is3d {
    cg-board::before {
      background-image: img-url('staunton/board/#{$name}.png');
    }

    $coord-color-white: map-get($theme, coord-color-white);
    $coord-color-black: map-get($theme, coord-color-black);

    @if $coord-color-white and $coord-color-black {
      coords {
        --cg-coord-color-white: #{$coord-color-white};
        --cg-coord-color-black: #{$coord-color-black};
        --cg-coord-shadow: none;
      }
    }
  }
}

$piece-files: (
  'Staunton': false,
  'Basic': true,
  'Experimental': true,
  'Glass': true,
  'Metal': true,
  'ModernJade': true,
  'ModernWood': true,
  'RedVBlue': true,
  'Trimmed': true,
  'Wood': true,
  'CubesAndPi': true,
);

@each $name, $flips in $piece-files {
  @each $color in 'White', 'Black' {
    @each $type in 'Pawn', 'Bishop', 'Knight', 'Rook', 'Queen', 'King' {
      .#{$name} .#{to-lower-case($type)}.#{to-lower-case($color)} {
        background-image: img-url('staunton/piece/#{$name}/#{$color}-#{$type}.png');
      }
    }

    @if $flips {
      @each $color, $orientation in ('White': 'black', 'Black': 'white') {
        @each $type in 'Bishop', 'Knight' {
          .#{$name} .main-board .orientation-#{$orientation} .#{to-lower-case($type)}.#{to-lower-case($color)} {
            background-image: img-url('staunton/piece/#{$name}/#{$color}-#{$type}-Flipped.png');
          }
        }
      }
    }
  }
}

#promotion-choice piece {
  width: 140.625%;
  height: 197.925%;
  top: 0;
  left: -18%;
  transform: scale(0.7) translateY(-45%);
  background-position: 0 -6px;
}

.main-board,
.eval-gauge {
  margin-top: 4vh;
}

.board-resize {
  $resize-width: 20px;

  @include breakpoint($mq-col2-uniboard) {
    bottom: #{28px - $resize-width} !important;
  }
}
