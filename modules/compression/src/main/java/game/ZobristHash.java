package org.lishogi.compression.game;

class ZobristHash {
    public static int hashBoard(Board board) {
        return hashPieces(board) ^ hashCastling(board) ^ hashTurn(board) ^ hashEnPassant(board);
    }

    public static int hashPieces(Board board) {
        int hash = 0;
        long occupied = board.occupied;
        while (occupied != 0) {
            int sq = Bitboard.lsb(occupied);
            hash ^= hashPiece(sq, board.whiteAt(sq), board.roleAt(sq));
            occupied &= occupied - 1L;
        }
        return hash;
    }

    public static int hashPiece(int square, boolean color, Role role) {
        int index = role.index * 2 + (color ? 1 : 0);
        return POLYGLOT[64 * index + square];
    }

    public static int hashCastling(Board board) {
        int hash = 0;
        long cr = board.castlingRights;
        if (Bitboard.contains(cr, Square.H1)) hash ^= POLYGLOT[768];
        if (Bitboard.contains(cr, Square.A1)) hash ^= POLYGLOT[768 + 1];
        if (Bitboard.contains(cr, Square.H8)) hash ^= POLYGLOT[768 + 2];
        if (Bitboard.contains(cr, Square.A8)) hash ^= POLYGLOT[768 + 3];
        return hash;
    }

    public static int hashTurn(Board board) {
        return board.turn ? POLYGLOT[780] : 0;
    }

    public static int hashEnPassant(Board board) {
        return board.hasLegalEnPassant() ? POLYGLOT[772 + Square.file(board.epSquare)] : 0;
    }

    // The upper 24 bits of polyglot compatible pseudo random masks for
    // Zobrist hashing.
    public static final int POLYGLOT[] = {
        0x9d3924, 0x2af739, 0x44db01, 0x9c15f7, 0x758344, 0x3290ac,
        0x0fbbad, 0xe83a90, 0x0d7e76, 0x1a0838, 0x9605d5, 0xd021ff,
        0x40bdf1, 0x011355, 0x5db483, 0x239f8b, 0x05d1a1, 0x679f84,
        0x7449bb, 0x7d11cd, 0x82c770, 0xf3218f, 0x331478, 0x4bb38d,
        0xaa649c, 0x8dbd98, 0x87d207, 0x19f3c7, 0xb4ab30, 0x7b0500,
        0xc9452c, 0x24aa6c, 0x4c9f34, 0x14a68f, 0xa71b9b, 0x03488b,
        0x637b2b, 0x09d1bc, 0x357566, 0x735e2b, 0x187270, 0x1fcbac,
        0xd310a7, 0xbf983f, 0x9f74d1, 0x51ebdc, 0x5c82c5, 0xfcf7fe,
        0x3253a7, 0x8c74c3, 0xb9bc6c, 0x7ef48f, 0x11d505, 0x6568fc,
        0x4de0b0, 0x96d693, 0x42e240, 0x6d2bdc, 0x42880b, 0x5f0f4a,
        0x39f890, 0x93c5b5, 0x63dc35, 0xec16ca, 0x5355f9, 0x07fb9f,
        0x509341, 0x7bcbc3, 0x19fc8a, 0x637a77, 0x8249a4, 0x79ad69,
        0x14acba, 0xf145b6, 0xdabf2a, 0x24c3c9, 0xbb6e29, 0x0ce26c,
        0xa49cd1, 0xe99d66, 0x27e6ad, 0x8535f0, 0x54b3f4, 0x72b12c,
        0xee954d, 0x9a85ac, 0x70ac4c, 0xf9b89d, 0x87b3e2, 0xa366e5,
        0xae4a93, 0x1920c0, 0x87bf02, 0x092237, 0xff07f6, 0x8de8dc,
        0x9c1633, 0xb3f22c, 0x390e5f, 0x5bfea5, 0x1e1032, 0x9a74ac,
        0x4f80f7, 0x6304d0, 0x2171e6, 0x5b9b63, 0x506aac, 0x1881af,
        0x650308, 0xdfd395, 0xef927d, 0x7b32f7, 0xb9fd76, 0x05a7e8,
        0xb5889c, 0x4a750a, 0xcf464c, 0xf53863, 0x3c79a0, 0xede6c8,
        0x799e81, 0x86536b, 0x97d737, 0xa24663, 0x043fca, 0x920e44,
        0x70eb09, 0x73a192, 0x56436c, 0xefac4b, 0xbb2157, 0x45f200,
        0x930f80, 0xff6712, 0xae623f, 0xdd2c5b, 0x7eed12, 0x22fe54,
        0xc91800, 0x808bd6, 0xdec468, 0x1bede3, 0x435396, 0xaa969b,
        0xa87832, 0x65942c, 0xded2d6, 0x21f085, 0xb41593, 0x91b859,
        0x10cff3, 0x28aed1, 0xc5cc1d, 0x5648f6, 0x2d2550, 0x9bc5a3,
        0xef2f05, 0xaf2042, 0x480412, 0xaef3af, 0x19afe5, 0x525938,
        0xf4f076, 0x113796, 0xbce5d2, 0x9da424, 0x066f70, 0x4dc4de,
        0x51039a, 0xc07a3f, 0xb46ee9, 0xb3819a, 0x21a007, 0x2df16f,
        0x763c4a, 0xf793c4, 0xd7288e, 0xde336a, 0x0bf692, 0x2c604a,
        0x4850e7, 0xcfc447, 0xb05ca3, 0x9ae182, 0xa4fc4b, 0xe75517,
        0x69b97d, 0xf9b5b7, 0xfc6a82, 0x9c684c, 0x8ec97d, 0x6703df,
        0xc547f5, 0x78e376, 0xfe9a44, 0x08bd35, 0x9315e5, 0x94061b,
        0xdf1d9f, 0x3bba57, 0xd2b7ad, 0xf7a255, 0xd7f4f2, 0xd95be8,
        0x336f52, 0xa74049, 0xa2f61b, 0x4f2a5c, 0x87d380, 0x16b9f7,
        0x7ba248, 0xf3a678, 0x39b0bf, 0xfcaf55, 0x18fcf6, 0x4c0563,
        0x40e087, 0x8cffa9, 0x68ca39, 0x7a1ee9, 0x9d1d60, 0x3810e3,
        0x32095b, 0x35cab6, 0xa90b24, 0x77a225, 0x513e5e, 0x4361c0,
        0xd941ac, 0x528f7c, 0x52ab92, 0x9d1dfa, 0x722ff1, 0x1d1260,
        0x7a249a, 0x04208f, 0x5a110c, 0x0cd9a4, 0x56fd23, 0x284c84,
        0x04feab, 0x742e1e, 0x9a9632, 0x881b82, 0x506e67, 0xb0183d,
        0x0ed9b9, 0x5e11e8, 0xf67864, 0x1b85d4, 0xdab9fe, 0x0d151d,
        0xa865a5, 0x93c425, 0x99e7af, 0x48cbff, 0x7f9b6a, 0x58627e,
        0x2cd16e, 0xd363ef, 0x0ce2a3, 0x1a804a, 0x907f30, 0x501f65,
        0x37624a, 0x957baf, 0x3a6c27, 0xd49503, 0x088e04, 0xf943ae,
        0x6c3b8e, 0x364f6f, 0xd60f6d, 0x56963b, 0x16f50e, 0xef1955,
        0x565601, 0xecb539, 0xbac7a9, 0xb344c4, 0x65d349, 0xb4b81b,
        0xb42206, 0x071582, 0x7a13f1, 0xbc4097, 0x59b978, 0x99170a,
        0x6f4233, 0x325928, 0xd0e436, 0x565c31, 0x30f561, 0xd873db,
        0x7bd94e, 0xc7d9f1, 0x947ae0, 0xc8c938, 0x3a9bf5, 0xd9a11f,
        0x0fd220, 0xb3f256, 0xb03031, 0x35dd37, 0xe9f608, 0xebfafa,
        0x9255ab, 0xb9ab4c, 0x693501, 0xc62c58, 0xcd454f, 0xbbe83f,
        0xdc842b, 0xba8914, 0xa3bc94, 0xe9f676, 0x09c7e5, 0x852f54,
        0x8107fc, 0x098954, 0x23b70e, 0xc330de, 0x4715ed, 0xa8d7e4,
        0x0572b9, 0xb57d2e, 0xe8d9ec, 0x2fe4b1, 0x11317b, 0x7fbf21,
        0x1725ca, 0x964e91, 0x3e2b8b, 0xbe7444, 0xf85b2b, 0x49353f,
        0x1dd01a, 0x1fca8a, 0xfc7c95, 0x18a6a9, 0xcccb70, 0x3bdbb9,
        0xaa70b5, 0xe94c39, 0xb7a0b1, 0xd4dba8, 0x2e18bc, 0x2de096,
        0xb9c11d, 0x64972d, 0x94628d, 0xdbc0d2, 0xd2733c, 0x7e75d9,
        0x6ced19, 0x97fcaa, 0x7b7749, 0x8547ed, 0x79999c, 0xcffe19,
        0x829626, 0x92fae2, 0x63e22c, 0xc678b6, 0x587388, 0x0981dc,
        0x9f6578, 0x9ff38f, 0xe479ee, 0xe7f28e, 0x56c074, 0x5544f7,
        0x7b3f01, 0x121536, 0x7f5126, 0x7a7695, 0x3d5774, 0x8a1b08,
        0x7b4a38, 0x950113, 0x4da897, 0x3bc36e, 0x5d0a12, 0x7f9d1a,
        0xda3a36, 0xdcdd7d, 0x368333, 0xce6834, 0xab9090, 0x43954b,
        0xb438c2, 0x10dcd7, 0xdbc27a, 0x9b3cdb, 0xb67b78, 0xbfced1,
        0xa9119b, 0x1fff7a, 0xac12fb, 0xaf08da, 0x1b0cab, 0xb559eb,
        0xc37b45, 0xc3a9dc, 0xf3b8b6, 0x9fc477, 0x67378d, 0x6dd856,
        0xa319ce, 0x073973, 0x8a8e84, 0xe1925c, 0x74c04b, 0x4dda48,
        0x9d266d, 0x7440fb, 0x133285, 0xd6bf7b, 0x4838d6, 0x1e1523,
        0x8f8419, 0x72c883, 0xd7a023, 0x94ebc8, 0x9fc10d, 0xde68a2,
        0xa44cfe, 0x9d1d84, 0x51d2b1, 0x2fd7e4, 0x65ca5b, 0xdd69a0,
        0x604d51, 0x73aa8a, 0x1a8c1e, 0xaac40a, 0x764dbe, 0x1e99b9,
        0x2c5e9d, 0x3a938f, 0x26e6db, 0x469356, 0xc8763c, 0x3f6c6a,
        0x7f7cc3, 0x9bfb22, 0x89039d, 0x8fe88b, 0xa09e8c, 0xfa7e39,
        0xd6b6d0, 0xdfea21, 0xb67c1f, 0xca1e37, 0x1cfc8b, 0xd18d85,
        0x4ed0fe, 0xe4dbf0, 0x1761f9, 0x53898e, 0x734de8, 0x2680b1,
        0x298af2, 0x7983ee, 0x66c1a2, 0x9e17e4, 0xedb454, 0x50b704,
        0x4cc317, 0x66b483, 0x219b97, 0x261e4e, 0x1fe2cc, 0xd7504d,
        0xb9571f, 0x1ddc03, 0xcf3f46, 0xf4f5d0, 0x38b652, 0x36f60e,
        0xeb3593, 0x9c4cd6, 0xaf0c31, 0x258e5a, 0x8b889d, 0xf4d145,
        0xd4347f, 0xe699ed, 0x2472f6, 0xc2a1e7, 0xab4f64, 0x637675,
        0xa59e0b, 0x116d00, 0x2cf9c8, 0x0b090a, 0xabeedd, 0x58efc1,
        0xc6e57a, 0x2eab8c, 0x14a195, 0x7c0828, 0xd74bbe, 0x804456,
        0xebe9ea, 0x03219a, 0x49787f, 0xa1e930, 0x5b45e5, 0xb49c3b,
        0xd4490a, 0x12a8f2, 0x001f83, 0x1877b5, 0xa2853b, 0x993e1d,
        0xb35980, 0x252f59, 0xd23c8e, 0x1bda04, 0x21e0bd, 0x3b097a,
        0x8d14de, 0xf95cff, 0x387170, 0xca672b, 0x64c8e5, 0x241260,
        0x106c09, 0x7fba19, 0x7884d9, 0x0647df, 0x63573f, 0x4fc8e9,
        0x1db956, 0xb8d912, 0xa2ebee, 0xd9f1f3, 0xefed53, 0x2e6d02,
        0xa9aa4d, 0xb64be8, 0x70cb6a, 0x98f076, 0xbf8447, 0x94c325,
        0x3e003e, 0xb925a6, 0x61bdd1, 0xbf8d51, 0x240ab5, 0xfc8761,
        0xef02cd, 0xa1082c, 0x8215e5, 0xd39bb9, 0x273825, 0x61cf4f,
        0x1b6bac, 0x758f45, 0x959f58, 0xb063e9, 0x60e8ed, 0x7b6497,
        0xfd080d, 0x8c90fd, 0x106f72, 0x797603, 0xa4ec01, 0x733ea7,
        0xb4d8f7, 0x9e21f4, 0x9d765e, 0xd30c08, 0x5d9433, 0x1a4e48,
        0x6ffe73, 0xddf957, 0x64d0e2, 0x08dd9b, 0x087e79, 0xe328e2,
        0x1c2559, 0x720bf5, 0xb0774d, 0x443f64, 0x4112cf, 0xd813f2,
        0x660d32, 0x59ac2c, 0xe84696, 0x93b633, 0xc0c0f5, 0xcaf21e,
        0x572777, 0x506c11, 0xd83cc2, 0x4a29c6, 0xed2df2, 0xb5635c,
        0x22af00, 0x52e762, 0x9aeba3, 0x944f6d, 0x6c47be, 0x6ad047,
        0xa5b1cf, 0x7c45d8, 0x5092ef, 0x9338e6, 0x455a4b, 0x6b02e6,
        0x6b17b2, 0xd1e0cc, 0xde0c89, 0x50065e, 0x9c1169, 0x78edef,
        0x6dc93d, 0xee97f4, 0x32ab0e, 0x3a6853, 0x31865c, 0x67fef9,
        0x1f2b1d, 0xb69e38, 0xaa9119, 0xf43c73, 0xfb4a3d, 0x3550c2,
        0x371f77, 0x6bfa9a, 0xcd04f3, 0xe32735, 0x9f9150, 0x049a7f,
        0xfcb6be, 0x08de8a, 0x8f9887, 0xb5b407, 0x230e34, 0x43ed7f,
        0x3a88a0, 0x21874b, 0x1bdea1, 0x53c065, 0xe34a1d, 0xd6b04d,
        0x5e9027, 0x2c046f, 0xb10bb4, 0x3fa9dd, 0x0e09b8, 0x10e8b3,
        0x9eedec, 0xd4c718, 0x81536d, 0x91b534, 0xec8177, 0x190e71,
        0xb592bf, 0x89c350, 0xac042e, 0xb49b52, 0xfb152f, 0x3e666e,
        0x3b544e, 0xe805a1, 0x24b33c, 0xe74733, 0x0a804d, 0x57e330,
        0x4ae7d6, 0x2d8d54, 0xd1e649, 0x8a328a, 0x07a3ae, 0x84547d,
        0x990a98, 0x1a4ff1, 0xf6f7fd, 0x30c05b, 0x8d2636, 0x46c9fe,
        0xccec0a, 0x4e9d28, 0x19ebb0, 0x4659d2, 0x963ef2, 0x74f851,
        0x5a0f54, 0x037270, 0xc7f6aa, 0x352787, 0x9853ea, 0xabbdcd,
        0xcf05da, 0x49cad4, 0x7a4c10, 0xd9e92a, 0x13ae97, 0x730499,
        0x4e4b70, 0xff5772, 0x55b634, 0xb86222, 0xcac09a, 0xdaf8e9,
        0xb5fdfc, 0x310cb3, 0xe87fbb, 0x2102ae, 0xf8549e, 0x07a69a,
        0xc4c118, 0xf9f489, 0x1af3db, 0xf5b4b0, 0x962ace, 0x046e3e,
        0xf05d12, 0x964781, 0x9c2ed4, 0x522e23, 0x177e00, 0x2bc60a,
        0x222bbf, 0x486289, 0x7dc778, 0x8af387, 0x1fab64, 0xe4d942,
        0x9da058, 0x24c0e3, 0x233003, 0xd586bd, 0x5e5637, 0x7eba72,
        0x0a56a5, 0xd79476, 0x9e4c12, 0x17efee, 0x1d95b0, 0x93cbe0,
        0x65fa4f, 0xd5f9e8, 0xc2b5a0, 0x593002, 0xce2f86, 0x7ca972,
        0x278533, 0xc61bb3, 0x150f36, 0x9f6a41, 0x64a53d, 0x142de4,
        0x0c3352, 0x0a9c32, 0xe6c421, 0x71f1ce, 0xf1bcc3, 0xe728e8,
        0x96fbf8, 0x81a154, 0x5fa786, 0x56986e, 0x917f1d, 0xd20d8c,
        0x31d71d, 0xf165b5, 0xa57e63, 0x1ef6e6, 0x70cc73, 0xe21a6b,
        0x003a93, 0x1c99de, 0xcf3145, 0xd0e442, 0x77c621, 0x67a34d,
        0xf8d626,
    };
}
