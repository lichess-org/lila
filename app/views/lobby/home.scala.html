@(data: play.api.libs.json.JsObject, userTimeline: Vector[lila.timeline.Entry], forumRecent: List[lila.forum.MiniForumPost], tours: List[Tournament], events: List[lila.event.Event], simuls: List[lila.simul.Simul], featured: Option[Game], leaderboard: List[User.LightPerf], tournamentWinners: List[lila.tournament.Winner], puzzle: Option[lila.puzzle.DailyPuzzle], streams: lila.streamer.LiveStreams.WithTitles, lastPost: List[lila.blog.MiniPost], playban: Option[lila.playban.TempBan], currentGame: Option[lila.app.mashup.Preload.CurrentGame], nbRounds: Int)(implicit ctx: Context)

@import play.api.libs.json.Json

@underchat = {
<div id="featured_game">
  @featured.map { g =>
  @gameFen(Pov.first(g), tv = true)
  @game.bits.vstext(Pov.first(g))(ctx.some).toHtml
  }
</div>
}

@side = {
@NotForKids {
<div id="streams_on_air">@streamer.liveStreams(streams)</div>
}
@events.map { e =>
@event.homepageSpotlight(e)
}
@if(!ctx.isBot) {
@lila.tournament.Spotlight.select(tours, ctx.me, 3).map { tour =>
@tournament.homepageSpotlight(tour)
}
@simuls.find(_.spotlightable).take(2).map { s =>
@simul.homepageSpotlight(s)
}
}
@ctx.me.map { u =>
<div id="timeline" data-href="@routes.Timeline.home">
  @timeline.entries(userTimeline)
  <div class="links">
    @if(userTimeline.size >= 8) {
    <a class="more" href="@routes.Timeline.home">@trans.more() »</a>
    }
  </div>
</div>
}.getOrElse {
<div class="about-side">
  @trans.xIsAFreeYLibreOpenSourceChessServer("Lichess", Html(s"""<a class="blue" href="${routes.Plan.features}">${trans.really.txt()}</a>"""))
  <a class="blue" href="/about">@trans.aboutX("lichess.org")...</a>
</div>
}
}

@baseline = {
<a id="nb_connected_players" href="@routes.User.list">
  @trans.nbPlayers(Html("<strong>-,---</strong>"))
</a>
<a id="nb_games_in_play" href="@routes.Tv.games">
  @trans.nbGamesInPlay.plural(nbRounds, Html(s"<span>${nbRounds}</span>"))
</a>
@if(ctx.isMobileBrowser) {
@if(lila.common.HTTPRequest.isAndroid(ctx.req)) {
@mobile.googlePlayButton()
} else {
@if(lila.common.HTTPRequest.isIOS(ctx.req)) {
@mobile.appleStoreButton()
}
}
}
}

@moreJs = {
@jsAt(s"compiled/lichess.lobby${isProd??(".min")}.js", async = true)
@embedJs {
window.customWS = true;
lichess_lobby = {
data: @safeJson(data),
playban: @htmlOrNull(playban) { pb =>
@safeJson(Json.obj("minutes" -> pb.mins, "remainingSeconds" -> (pb.remainingSeconds + 3)))
},
currentGame: @htmlOrNull(currentGame) { cg =>
@safeJson(cg.json)
},
i18n: @jsI18n()
};
}
}

@base.layout(
title = "",
fullTitle = Some("lichess.org • " + trans.freeOnlineChess.txt()),
baseline = baseline.some,
side = side.some,
moreJs = moreJs,
moreCss = cssTag("home.css"),
underchat = underchat.some,
chessground = false,
openGraph = lila.app.ui.OpenGraph(
image = staticUrl("images/large_tile.png").some,
title = "The best free, adless Chess server",
url = netBaseUrl,
description = trans.siteDescription.txt()
).some,
asyncJs = true) {
<div class="lobby_and_ground@if(playban.isDefined){ playban}@if(currentGame.isDefined){ current_game}">
  @currentGame.map(currentGameInfo(_))
  <div id="hooks_wrap"></div>
  @playban.map(ban => playbanInfo(ban.remainingSeconds))
  <div id="start_buttons" class="lichess_ground">
    <a class="fat button config_hook@if(playban.isDefined || currentGame.isDefined || ctx.isBot){ disabled}" href="@routes.Setup.hookForm">@trans.createAGame()</a>
    <a class="fat button config_friend@if(currentGame.isDefined){ disabled}" href="@routes.Setup.friendForm(none)">@trans.playWithAFriend()</a>
    <a class="fat button config_ai@if(currentGame.isDefined){ disabled}" href="@routes.Setup.aiForm">@trans.playWithTheMachine()</a>
  </div>
</div>
@puzzle.map { p =>
<div id="daily_puzzle" title="@trans.clickToSolve()">
  @Html(p.html)
  <div class="vstext">
    @trans.puzzleOfTheDay()<br />
    @p.color.fold(trans.whitePlays, trans.blackPlays)()
  </div>
</div>
}
@if(!ctx.isBot) {
<div class="undertable">
  <div class="undertable_top">
    <a class="more hint--bottom" data-hint="@trans.seeAllTournaments()" href="@routes.Tournament.home()">@trans.more() »</a>
    <span class="title text" data-icon="g">@trans.openTournaments()</span>
  </div>
  <div id="enterable_tournaments" class="enterable_list undertable_inner scroll-shadow-hard">
    @tournament.enterable(tours).toHtml
  </div>
</div>
<div class="undertable @if(simuls.isEmpty){none}">
  <div class="undertable_top">
    <a class="more" href="@routes.Simul.home">@trans.more() »</a>
    <span class="title text" data-icon="|">@trans.simultaneousExhibitions()</span>
  </div>
  <div id="enterable_simuls" class="enterable_list undertable_inner">
    @simul.allCreated(simuls).toHtml
  </div>
</div>
<div class="leaderboards undertable">
  <div class="leaderboard">
    <div class="user_top">
      <div class="undertable_top">
        <a class="more hint--bottom" data-hint="@trans.players()" href="@routes.User.list()">@trans.more() »</a>
        <span class="title text" data-icon="C">@trans.leaderboard()</span>
      </div>
      <div class="undertable_inner scroll-shadow-hard">
        <table>
          <tbody>
            @leaderboard.map { l =>
            <tr>
              <td>@lightUserLink(l.user)</td>
              @lila.rating.PerfType(l.perfKey).map { pt =>
              <td data-icon="@pt.iconChar" class="text">@l.rating</td>
              }
              <td>@showProgress(l.progress, withTitle = false)</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="leaderboard">
    <div class="user_top">
      <div class="undertable_top">
        <a class="more hint--bottom" href="@routes.Tournament.leaderboard">@trans.more() »</a>
        <span class="title" data-icon="g"> @trans.tournamentWinners()</span>
      </div>
      <div class="undertable_inner scroll-shadow-hard">
        <table>
          <tbody>
            @tournamentWinners.take(10).map { w =>
            <tr>
              <td>@userIdLink(w.userId.some)</td>
              <td><a title="@w.tourName" href="@routes.Tournament.show(w.tourId)">@scheduledTournamentNameShortHtml(w.tourName)</a></td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
}
@NotForKids {
<div class="new_posts undertable">
  <div class="undertable_top">
    <a class="more hint--bottom" data-hint="@trans.forum()" href="@routes.ForumCateg.index()">@trans.more() »</a>
    <span class="title" data-icon="d"> @trans.latestForumPosts()</span>
  </div>
  <div class="undertable_inner scroll-shadow-hard">
    <div class="content">@forum.post.recent(forumRecent).toHtml</div>
  </div>
</div>
}
@if(lastPost.nonEmpty) {
<div class="blog undertable">
  <div class="undertable_top">
    <a class="more hint--bottom" data-hint="@trans.blog()" href="@routes.Blog.index()">@trans.more() »</a>
    <span class="title" data-icon="6"> @trans.latestUpdates()</span>
  </div>
  <div class="undertable_inner">
    @lastPost.map { post =>
    <div class="post">
      @defining(routes.Blog.show(post.id, post.slug)) { url =>
      <a class="image" href="@url">
        <img src="@post.image" width="60" height="60" />
      </a>
      <div class="text">
        @semanticDate(post.date)
        <a class="title" href="@url">@post.title</a>
        <p class="shortlede">@post.shortlede</p>
      </div>
      }
    </div>
    }
  </div>
</div>
}
<div class="donation undertable">
  <a href="@routes.Plan.index">
    <i data-icon="@patronIconChar"></i>
    <strong>Lichess Patron</strong>
    <span>@trans.directlySupportLichess()</span>
  </a>
  <a href="@routes.Page.swag">
    <i data-icon=""></i>
    <strong>Swag Store</strong>
    <span>@trans.playChessInStyle()</span>
  </a>
</div>
<div class="about-footer"><a href="/about">@trans.aboutX("lichess.org")</a></div>
}
