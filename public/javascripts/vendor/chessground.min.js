!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Chessground=e()}}(function(){var e;return function t(e,n,r){function o(i,c){if(!n[i]){if(!e[i]){var u="function"==typeof require&&require;if(!c&&u)return u(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var s=n[i]={exports:{}};e[i][0].call(s.exports,function(t){var n=e[i][1][t];return o(n?n:t)},s,s.exports,t,e,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){function r(e,t){var n=new a(t);return o.render(e,i(n)),c(n)}var o=e("mithril"),a=e("./ctrl"),i=e("./view"),c=e("./api");t.exports=r,t.exports.controller=a,t.exports.view=i,t.exports.fen=e("./fen"),t.exports.util=e("./util"),t.exports.configure=e("./configure"),t.exports.anim=e("./anim"),t.exports.board=e("./board"),t.exports.drag=e("./drag")},{"./anim":4,"./api":5,"./board":6,"./configure":7,"./ctrl":8,"./drag":10,"./fen":12,"./util":16,"./view":17,mithril:3}],2:[function(e,t,n){!function(e){function n(e,t){if("object"!==o(e))return t;for(var r in t)e[r]="object"===o(e[r])&&"object"===o(t[r])?n(e[r],t[r]):t[r];return e}function r(e,t,r){var i=r[0],c=r.length;(e||"object"!==o(i))&&(i={});for(var u=0;c>u;++u){var l=r[u],s=o(l);if("object"===s)for(var d in l){var f=e?a.clone(l[d]):l[d];i[d]=t?n(i[d],f):f}}return i}function o(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var a=function(e){return r(e===!0,!1,arguments)},i="merge";a.recursive=function(e){return r(e===!0,!0,arguments)},a.clone=function(e){var t,n,r=e,i=o(e);if("array"===i)for(r=[],n=e.length,t=0;n>t;++t)r[t]=a.clone(e[t]);else if("object"===i){r={};for(t in e)r[t]=a.clone(e[t])}return r},e?t.exports=a:window[i]=a}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)},{}],3:[function(t,n,r){!function(t,r){"use strict";var o=r(t);"object"==typeof n&&null!=n&&n.exports?n.exports=o:"function"==typeof e&&e.amd?e(function(){return o}):t.m=o}("undefined"!=typeof window?window:{},function(e,t){"use strict";function n(e){return"function"==typeof e}function r(e){return"[object Object]"===Oe.call(e)}function o(e){return"[object String]"===Oe.call(e)}function a(){}function i(e){ke=e.document,xe=e.location,Pe=e.cancelAnimationFrame||e.clearTimeout,Ce=e.requestAnimationFrame||e.setTimeout}function c(e,t){for(var n,r=[],o=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g;n=o.exec(t);)if(""===n[1]&&n[2])e.tag=n[2];else if("#"===n[1])e.attrs.id=n[2];else if("."===n[1])r.push(n[2]);else if("["===n[3][0]){var a=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/.exec(n[3]);e.attrs[a[1]]=a[3]||(a[2]?"":!0)}return r}function u(e,t){var n=t?e.slice(1):e;return 1===n.length&&Me(n[0])?n[0]:n}function l(e,t,n){var r="class"in t?"class":"className";for(var o in t)Ee.call(t,o)&&(o===r&&null!=t[o]&&""!==t[o]?(n.push(t[o]),e[o]=""):e[o]=t[o]);n.length&&(e[r]=n.join(" "))}function s(e,t){var n=[].slice.call(arguments,1);if(r(e))return te(e,n);if(!o(e))throw new Error("selector in m(selector, attrs, children) should be a string");var a=null!=t&&r(t)&&!("tag"in t||"view"in t||"subtree"in t),i=a?t:{},s={tag:"div",attrs:{},children:u(n,a)};return l(s.attrs,i,c(s,e)),s}function d(e,t){for(var n=0;n<e.length&&!t(e[n],n++););}function f(e,t){d(e,function(e,n){return(e=e&&e.attrs)&&null!=e.key&&t(e,n)})}function p(e){try{if(null!=e&&null!=e.toString())return e}catch(t){}return""}function h(e,t,n,r){try{g(e,t,n),t.nodeValue=r}catch(o){}}function v(e){for(var t=0;t<e.length;t++)Me(e[t])&&(e=e.concat.apply([],e),t--);return e}function g(e,t,n){e.insertBefore(t,e.childNodes[n]||null)}function m(e,t,n,r){f(e,function(e,r){t[e=e.key]=t[e]?{action:Se,index:r,from:t[e].index,element:n.nodes[t[e].index]||ke.createElement("div")}:{action:Ne,index:r}});var o=[];for(var a in t)Ee.call(t,a)&&o.push(t[a]);var i=o.sort(X),c=new Array(n.length);return c.nodes=n.nodes.slice(),d(i,function(t){var o=t.index;if(t.action===Te&&(_(n[o].nodes,n[o]),c.splice(o,1)),t.action===Ne){var a=ke.createElement("div");a.key=e[o].attrs.key,g(r,a,o),c.splice(o,0,{attrs:{key:e[o].attrs.key},nodes:[a]}),c.nodes[o]=a}if(t.action===Se){var i=t.element,u=r.childNodes[o];u!==i&&null!==i&&r.insertBefore(i,u||null),c[o]=n[t.from],c.nodes[o]=i}}),c}function b(e,t,n,r){var o=e.length!==t.length;return o||f(e,function(e,n){var r=t[n];return o=r&&r.attrs&&r.attrs.key!==e.key}),o?m(e,n,t,r):t}function y(e,t,n){d(e,function(e,r){null!=t[r]&&n.push.apply(n,t[r].nodes)}),d(t.nodes,function(e,r){null!=e.parentNode&&n.indexOf(e)<0&&_([e],[t[r]])}),e.length<t.length&&(t.length=e.length),t.nodes=n}function w(e){var t=0;f(e,function(){return d(e,function(e){(e=e&&e.attrs)&&null==e.key&&(e.key="__mithril__"+t++)}),1})}function k(e,t,n){return e.tag!==t.tag?!0:n.sort().join()!==Object.keys(t.attrs).sort().join()?!0:e.attrs.id!==t.attrs.id?!0:e.attrs.key!==t.attrs.key?!0:"all"===s.redraw.strategy()?!t.configContext||t.configContext.retain!==!0:"diff"===s.redraw.strategy()?t.configContext&&t.configContext.retain===!1:!1}function x(e,t,r){k(e,t,r)&&(t.nodes.length&&_(t.nodes),t.configContext&&n(t.configContext.onunload)&&t.configContext.onunload(),t.controllers&&d(t.controllers,function(e){e.onunload&&e.onunload({preventDefault:a})}))}function C(e,t){return e.attrs.xmlns?e.attrs.xmlns:"svg"===e.tag?"http://www.w3.org/2000/svg":"math"===e.tag?"http://www.w3.org/1998/Math/MathML":t}function P(e,t,n){n.length&&(e.views=t,e.controllers=n,d(n,function(e){if(e.onunload&&e.onunload.$old&&(e.onunload=e.onunload.$old),je&&e.onunload){var t=e.onunload;e.onunload=a,e.onunload.$old=t}}))}function E(e,t,r,o,a){if(n(t.attrs.config)){var i=a.configContext=a.configContext||{};e.push(function(){return t.attrs.config.call(t,r,!o,i,a)})}}function O(e,n,r,o,a,i,c,u){var l=e.nodes[0];return o&&W(l,n.tag,n.attrs,e.attrs,a),e.children=U(l,n.tag,t,t,n.children,e.children,!1,0,n.attrs.contenteditable?l:r,a,c),e.nodes.intact=!0,u.length&&(e.views=i,e.controllers=u),l}function M(e,t,n){var r;e.$trusted?r=Y(t,n,e):(r=[ke.createTextNode(e)],t.nodeName in Ae||g(t,r[0],n));var o;return o="string"==typeof e||"number"==typeof e||"boolean"==typeof e?new e.constructor(e):e,o.nodes=r,o}function A(e,t,n,r,o,a){var i=t.nodes;return r&&r===ke.activeElement||(e.$trusted?(_(i,t),i=Y(n,o,e)):"textarea"===a?n.value=e:r?r.innerHTML=e:((1===i[0].nodeType||i.length>1||i[0].nodeValue.trim&&!i[0].nodeValue.trim())&&(_(t.nodes,t),i=[ke.createTextNode(e)]),h(n,i[0],o,e))),t=new e.constructor(e),t.nodes=i,t}function T(e,t,n,r,o,a,i){return e.nodes.length?e.valueOf()!==t.valueOf()||o?A(t,e,r,a,n,i):(e.nodes.intact=!0,e):M(t,r,n)}function N(e){if(e.$trusted){var t=e.match(/<[^\/]|\>\s*[^<]/g);if(null!=t)return t.length}else if(Me(e))return e.length;return 1}function S(e,n,r,o,a,i,c,u,l){e=v(e);var s=[],d=n.length===e.length,p=0,h={},g=!1;f(n,function(e,t){g=!0,h[n[t].attrs.key]={action:Te,index:t}}),w(e),g&&(n=b(e,n,h,r));for(var m=0,k=0,x=e.length;x>k;k++){var C=U(r,a,n,o,e[k],n[m],i,o+p||p,c,u,l);C!==t&&(d=d&&C.nodes.intact,p+=N(C),n[m++]=C)}return d||y(e,n,s),n}function j(e,t,n,r,o){if(null!=t){if(Oe.call(t)===Oe.call(e))return t;if(o&&o.nodes){var a=n-r,i=a+(Me(e)?e:t.nodes).length;_(o.nodes.slice(a,i),o.slice(a,i))}else t.nodes&&_(t.nodes,t)}return t=new e.constructor,t.tag&&(t={}),t.nodes=[],t}function D(e,t){return e.attrs.is?null==t?ke.createElement(e.tag,e.attrs.is):ke.createElementNS(t,e.tag,e.attrs.is):null==t?ke.createElement(e.tag):ke.createElementNS(t,e.tag)}function R(e,t,n,r){return r?W(t,e.tag,e.attrs,{},n):e.attrs}function q(e,n,r,o,a,i){return null!=e.children&&e.children.length>0?U(n,e.tag,t,t,e.children,r.children,!0,0,e.attrs.contenteditable?n:o,a,i):e.children}function L(e,t,n,r,o,a,i){var c={tag:e.tag,attrs:t,children:n,nodes:[r]};return P(c,a,i),c.children&&!c.children.nodes&&(c.children.nodes=[]),"select"===e.tag&&"value"in e.attrs&&W(r,e.tag,{value:e.attrs.value},{},o),c}function F(e,t,r,o){var a;return a="diff"===s.redraw.strategy()&&e?e.indexOf(t):-1,a>-1?r[a]:n(o)?new o:{}}function K(e,t,n,r){null!=r.onunload&&Re.push({controller:r,handler:r.onunload}),e.push(n),t.push(r)}function B(e,t,n,r,o,a){var i=F(n.views,t,r,e.controller),c=e&&e.attrs&&e.attrs.key;return e=0===je||qe||r&&r.indexOf(i)>-1?e.view(i):{tag:"placeholder"},"retain"===e.subtree?e:(e.attrs=e.attrs||{},e.attrs.key=c,K(a,o,t,i),e)}function I(e,t,n,r){for(var o=t&&t.controllers;null!=e.view;)e=B(e,e.view.$original||e.view,t,o,r,n);return e}function z(e,t,n,r,a,i,c,u){var l=[],s=[];if(e=I(e,t,l,s),"retain"===e.subtree)return t;if(!e.tag&&s.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");e.attrs=e.attrs||{},t.attrs=t.attrs||{};var d=Object.keys(e.attrs),f=d.length>("key"in e.attrs?1:0);if(x(e,t,d),o(e.tag)){var p=0===t.nodes.length;c=C(e,c);var h;if(p){h=D(e,c);var v=R(e,h,c,f),m=q(e,h,t,n,c,u);t=L(e,v,m,h,c,l,s)}else h=O(t,e,n,f,c,l,u,s);return(p||i===!0&&null!=h)&&g(r,h,a),E(u,e,h,p,t),t}}function U(e,t,o,a,i,c,u,l,s,d,f){return i=p(i),"retain"===i.subtree?c:(c=j(i,c,l,a,o),Me(i)?S(i,c,e,l,t,u,s,d,f):null!=i&&r(i)?z(i,c,s,e,l,u,d,f):n(i)?c:T(c,i,l,e,u,s,t))}function X(e,t){return e.action-t.action||e.index-t.index}function $(e,t,n){for(var r in t)Ee.call(t,r)&&(null==n||n[r]!==t[r])&&(e.style[r]=t[r]);for(r in n)Ee.call(n,r)&&(Ee.call(t,r)||(e.style[r]=""))}function G(e,t,o,a,i,c){if("config"===t||"key"===t)return!0;if(n(o)&&"on"===t.slice(0,2))e[t]=Q(o,e);else if("style"===t&&null!=o&&r(o))$(e,o,a);else if(null!=c)"href"===t?e.setAttributeNS("http://www.w3.org/1999/xlink","href",o):e.setAttribute("className"===t?"class":t,o);else if(t in e&&!Le[t])try{("input"!==i||e[t]!==o)&&(e[t]=o)}catch(u){e.setAttribute(t,o)}else e.setAttribute(t,o)}function H(e,t,n,r,o,a,i){if(t in o&&r===n)"value"===t&&"input"===a&&e.value!==n&&(e.value=n);else{o[t]=n;try{return G(e,t,n,r,a,i)}catch(c){if(c.message.indexOf("Invalid argument")<0)throw c}}}function W(e,t,n,r,o){for(var a in n)if(Ee.call(n,a)&&H(e,a,n[a],r[a],r,t,o))continue;return r}function _(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(r){}t=[].concat(t),t[n]&&J(t[n])}e.length&&(e.length=0)}function J(e){e.configContext&&n(e.configContext.onunload)&&(e.configContext.onunload(),e.configContext.onunload=null),e.controllers&&d(e.controllers,function(e){n(e.onunload)&&e.onunload({preventDefault:a})}),e.children&&(Me(e.children)?d(e.children,J):e.children.tag&&J(e.children))}function V(e,t){try{e.appendChild(ke.createRange().createContextualFragment(t))}catch(n){e.insertAdjacentHTML("beforeend",t)}}function Y(e,t,n){var r=e.childNodes[t];if(r){var o=1!==r.nodeType,a=ke.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else V(e,n);for(var i=[];e.childNodes[t]!==r;)i.push(e.childNodes[t]),t++;return i}function Q(e,t){return function(n){n=n||event,s.redraw.strategy("diff"),s.startComputation();try{return e.call(t,n)}finally{ae()}}}function Z(e){var t=Ke.indexOf(e);return 0>t?Ke.push(e)-1:t}function ee(e){function t(){return arguments.length&&(e=arguments[0]),e}return t.toJSON=function(){return e},t}function te(e,t){function n(){return(e.controller||a).apply(this,t)||this}function r(n){for(var r=[n].concat(t),o=1;o<arguments.length;o++)r.push(arguments[o]);return e.view.apply(e,r)}e.controller&&(n.prototype=e.controller.prototype),r.$original=e.view;var o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o}function ne(e,t,n,r){if(!r){s.redraw.strategy("all"),s.startComputation(),ze[n]=t;var o;o=Ie=e?e:e={controller:a};var i=new(e.controller||a);return o===Ie&&(Xe[n]=i,Ue[n]=e),ae(),null===e&&re(t,n),Xe[n]}null==e&&re(t,n)}function re(e,t){ze.splice(t,1),Xe.splice(t,1),Ue.splice(t,1),fe(e),Ke.splice(Z(e),1)}function oe(){He&&(He(),He=null),d(ze,function(e,t){var n=Ue[t];if(Xe[t]){var r=[Xe[t]];s.render(e,n.view?n.view(Xe[t],r):"")}}),We&&(We(),We=null),$e=null,Ge=new Date,s.redraw.strategy("diff")}function ae(){"none"===s.redraw.strategy()?(je--,s.redraw.strategy("diff")):s.endComputation()}function ie(e){return e.slice(Qe[s.route.mode].length)}function ce(e,t,n){Ve={};var r=n.indexOf("?");-1!==r&&(Ve=de(n.substr(r+1,n.length)),n=n.substr(0,r));var o=Object.keys(t),a=o.indexOf(n);if(-1!==a)return s.mount(e,t[o[a]]),!0;for(var i in t)if(Ee.call(t,i)){if(i===n)return s.mount(e,t[i]),!0;var c=new RegExp("^"+i.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(c.test(n))return n.replace(c,function(){var n=i.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2);d(n,function(e,t){Ve[e.replace(/:|\./g,"")]=decodeURIComponent(r[t])}),s.mount(e,t[i])}),!0}}function ue(e){if(e=e||event,!(e.ctrlKey||e.metaKey||e.shiftKey||2===e.which)){e.preventDefault?e.preventDefault():e.returnValue=!1;var t,n=e.currentTarget||e.srcElement;for(t="pathname"===s.route.mode&&n.search?de(n.search.slice(1)):{};n&&!/a/i.test(n.nodeName);)n=n.parentNode;je=0,s.route(n[s.route.mode].slice(Qe[s.route.mode].length),t)}}function le(){"hash"!==s.route.mode&&xe.hash?xe.hash=xe.hash:e.scrollTo(0,0)}function se(e,n){var o={},a=[];for(var i in e)if(Ee.call(e,i)){var c=n?n+"["+i+"]":i,u=e[i];if(null===u)a.push(encodeURIComponent(c));else if(r(u))a.push(se(u,c));else if(Me(u)){var l=[];o[c]=o[c]||{},d(u,function(e){o[c][e]||(o[c][e]=!0,l.push(encodeURIComponent(c)+"="+encodeURIComponent(e)))}),a.push(l.join("&"))}else u!==t&&a.push(encodeURIComponent(c)+"="+encodeURIComponent(u))}return a.join("&")}function de(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));var t=e.split("&"),n={};return d(t,function(e){var t=e.split("="),r=decodeURIComponent(t[0]),o=2===t.length?decodeURIComponent(t[1]):null;null!=n[r]?(Me(n[r])||(n[r]=[n[r]]),n[r].push(o)):n[r]=o}),n}function fe(e){var n=Z(e);_(e.childNodes,Be[n]),Be[n]=t}function pe(e,t){var n=s.prop(t);return e.then(n),n.then=function(n,r){return pe(e.then(n,r),t)},n["catch"]=n.then.bind(null,null),n}function he(e,t){function o(e){u=e||ot,d.map(function(e){u===rt?e.resolve(l):e.reject(l)})}function a(e,t,o,a){if((null!=l&&r(l)||n(l))&&n(e))try{var i=0;e.call(l,function(e){i++||(l=e,t())},function(e){i++||(l=e,o())})}catch(c){s.deferred.onerror(c),l=c,o()}else a()}function i(){var r;try{r=l&&l.then}catch(d){return s.deferred.onerror(d),l=d,u=nt,i()}u===nt&&s.deferred.onerror(l),a(r,function(){u=tt,i()},function(){u=nt,i()},function(){try{u===tt&&n(e)?l=e(l):u===nt&&n(t)&&(l=t(l),u=tt)}catch(i){return s.deferred.onerror(i),l=i,o()}l===c?(l=TypeError(),o()):a(r,function(){o(rt)},o,function(){o(u===tt&&rt)})})}var c=this,u=0,l=0,d=[];c.promise={},c.resolve=function(e){return u||(l=e,u=tt,i()),c},c.reject=function(e){return u||(l=e,u=nt,i()),c},c.promise.then=function(e,t){var n=new he(e,t);return u===rt?n.resolve(l):u===ot?n.reject(l):d.push(n),n.promise}}function ve(e){return e}function ge(n){var r="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),o=ke.createElement("script");e[r]=function(a){o.parentNode.removeChild(o),n.onload({type:"load",target:{responseText:a}}),e[r]=t},o.onerror=function(){return o.parentNode.removeChild(o),n.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),e[r]=t,!1},o.onload=function(){return!1},o.src=n.url+(n.url.indexOf("?")>0?"&":"?")+(n.callbackKey?n.callbackKey:"callback")+"="+r+"&"+se(n.data||{}),ke.body.appendChild(o)}function me(t){var r=new e.XMLHttpRequest;if(r.open(t.method,t.url,!0,t.user,t.password),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?t.onload({type:"load",target:r}):t.onerror({type:"error",target:r}))},t.serialize===JSON.stringify&&t.data&&"GET"!==t.method&&r.setRequestHeader("Content-Type","application/json; charset=utf-8"),t.deserialize===JSON.parse&&r.setRequestHeader("Accept","application/json, text/*"),n(t.config)){var a=t.config(r,t);null!=a&&(r=a)}var i="GET"!==t.method&&t.data?t.data:"";if(i&&!o(i)&&i.constructor!==e.FormData)throw new Error("Request data should be either be a string or FormData. Check the `serialize` option in `m.request`");return r.send(i),r}function be(e){return e.dataType&&"jsonp"===e.dataType.toLowerCase()?ge(e):me(e)}function ye(e,t,n){if("GET"===e.method&&"jsonp"!==e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=se(t);e.url+=o?r+o:""}else e.data=n(t)}function we(e,t){return t&&(e=e.replace(/:[a-z]\w+/gi,function(e){var n=e.slice(1),r=t[n];return delete t[n],r})),e}s.version=function(){return"v0.2.2-rc.1"};var ke,xe,Ce,Pe,Ee={}.hasOwnProperty,Oe={}.toString,Me=Array.isArray||function(e){return"[object Array]"===Oe.call(e)},Ae={AREA:1,BASE:1,BR:1,COL:1,COMMAND:1,EMBED:1,HR:1,IMG:1,INPUT:1,KEYGEN:1,LINK:1,META:1,PARAM:1,SOURCE:1,TRACK:1,WBR:1};s.deps=function(t){return i(e=t||window),e},s.deps(e);var Te=1,Ne=2,Se=3,je=0;s.startComputation=function(){je++},s.endComputation=function(){je>1?je--:(je=0,s.redraw())};var De,Re=[],qe=!1,Le={list:1,style:1,form:1,type:1,width:1,height:1},Fe={appendChild:function(e){De===t&&(De=ke.createElement("html")),ke.documentElement&&ke.documentElement!==e?ke.replaceChild(e,ke.documentElement):ke.appendChild(e),this.childNodes=ke.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},Ke=[],Be={};s.render=function(e,n,r){if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var o,a=[],i=Z(e),c=e===ke;o=c||e===ke.documentElement?Fe:e,c&&"html"!==n.tag&&(n={tag:"html",attrs:{},children:n}),Be[i]===t&&_(o.childNodes),r===!0&&fe(e),Be[i]=U(o,null,t,t,n,Be[i],!1,0,null,t,a),d(a,function(e){e()})},s.trust=function(e){return e=new String(e),e.$trusted=!0,e},s.prop=function(e){return(null!=e&&r(e)||n(e))&&n(e.then)?pe(e):ee(e)};var Ie,ze=[],Ue=[],Xe=[],$e=null,Ge=0,He=null,We=null,_e=16;s.component=function(e){var t=[].slice.call(arguments,1);return te(e,t)},s.mount=s.module=function(e,t){if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var r=ze.indexOf(e);0>r&&(r=ze.length);var o=!1,a={preventDefault:function(){o=!0,He=We=null}};return d(Re,function(e){e.handler.call(e.controller,a),e.controller.onunload=null}),o?d(Re,function(e){e.controller.onunload=e.handler}):Re=[],Xe[r]&&n(Xe[r].onunload)&&Xe[r].onunload(a),ne(t,e,r,o)};var Je=!1;s.redraw=function(t){if(!Je){Je=!0,t&&(qe=!0);try{$e&&!t?(Ce===e.requestAnimationFrame||new Date-Ge>_e)&&($e>0&&Pe($e),$e=Ce(oe,_e)):(oe(),$e=Ce(function(){$e=null},_e))}finally{Je=qe=!1}}},s.redraw.strategy=s.prop(),s.withAttr=function(e,t,n){return function(r){r=r||event;var o=r.currentTarget||this,a=n||this,i=e in o?o[e]:o.getAttribute(e);t.call(a,i)}};var Ve,Ye,Qe={pathname:"",hash:"#",search:"?"},Ze=a,et=!1;s.route=function(t,n,r,a){if(0===arguments.length)return Ye;if(3===arguments.length&&o(n)){Ze=function(e){var o=Ye=ie(e);if(!ce(t,r,o)){if(et)throw new Error("Ensure the default route matches one of the routes defined in m.route");et=!0,s.route(n,!0),et=!1}};var i="hash"===s.route.mode?"onhashchange":"onpopstate";return e[i]=function(){var e=xe[s.route.mode];"pathname"===s.route.mode&&(e+=xe.search),Ye!==ie(e)&&Ze(e)},He=le,void e[i]()}if(t.addEventListener||t.attachEvent){var c="pathname"!==s.route.mode?xe.pathname:"";return t.href=c+Qe[s.route.mode]+a.attrs.href,void(t.addEventListener?(t.removeEventListener("click",ue),t.addEventListener("click",ue)):(t.detachEvent("onclick",ue),t.attachEvent("onclick",ue)))}if(o(t)){var u=Ye;Ye=t;var l,d=n||{},f=Ye.indexOf("?");l=f>-1?de(Ye.slice(f+1)):{};for(var p in d)Ee.call(d,p)&&(l[p]=d[p]);var h,v=se(l);h=f>-1?Ye.slice(0,f):Ye,v&&(Ye=h+(-1===h.indexOf("?")?"?":"&")+v);var g=(3===arguments.length?r:n)===!0||u===t;if(e.history.pushState){var m=g?"replaceState":"pushState";He=le,We=function(){e.history[m](null,ke.title,Qe[s.route.mode]+Ye)},Ze(Qe[s.route.mode]+Ye)}else xe[s.route.mode]=Ye,Ze(Qe[s.route.mode]+Ye)}},s.route.param=function(e){if(!Ve)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return e?Ve[e]:Ve},s.route.mode="search",s.route.buildQueryString=se,s.route.parseQueryString=de,s.deferred=function(){var e=new he;return e.promise=pe(e.promise),e};var tt=1,nt=2,rt=3,ot=4;return s.deferred.onerror=function(e){if("[object Error]"===Oe.call(e)&&!/ Error/.test(e.constructor.toString()))throw je=0,e},s.sync=function(e){function t(e,t){return function(i){return o[e]=i,t||(a="reject"),0===--r&&(n.promise(o),n[a](o)),i}}var n=s.deferred(),r=e.length,o=new Array(r),a="resolve";return e.length>0?d(e,function(e,n){e.then(t(n,!0),t(n,!1))}):n.resolve([]),n.promise},s.request=function(e){e.background!==!0&&s.startComputation();var t,n,r,o=new he,a=e.dataType&&"jsonp"===e.dataType.toLowerCase();return a?(t=e.serialize=n=e.deserialize=ve,r=function(e){return e.responseText}):(t=e.serialize=e.serialize||JSON.stringify,n=e.deserialize=e.deserialize||JSON.parse,r=e.extract||function(e){return e.responseText.length||n!==JSON.parse?e.responseText:null}),e.method=(e.method||"GET").toUpperCase(),e.url=we(e.url,e.data),ye(e,e.data,t),e.onload=e.onerror=function(t){try{t=t||event;var a=n(r(t.target,e));"load"===t.type?(e.unwrapSuccess&&(a=e.unwrapSuccess(a,t.target)),Me(a)&&e.type?d(a,function(t,n){a[n]=new e.type(t)}):e.type&&(a=new e.type(a)),o.resolve(a)):(e.unwrapError&&(a=e.unwrapError(a,t.target)),o.reject(a))}catch(i){o.reject(i)}finally{e.background!==!0&&s.endComputation()}},be(e),o.promise=pe(o.promise,e.initialValue),o.promise},s})},{}],4:[function(e,t,n){function r(e,t,n){var r=n?s.invertKey(e):e;return{key:r,pos:s.key2pos(r),role:t.role,color:t.color}}function o(e,t){return e.role===t.role&&e.color===t.color}function a(e,t){return t.sort(function(t,n){return s.distance(e.pos,t.pos)-s.distance(e.pos,n.pos)})[0]}function i(e,t){var n=t.bounds(),i=n.width/8,c=n.height/8,u={},l=[],d=[],f=[],p=[],h=e.orientation!==t.orientation,v={},g="white"===t.orientation;for(var m in e.pieces){var b=r(m,e.pieces[m],h);v[b.key]=b}for(var y=0;y<s.allKeys.length;y++){var w=s.allKeys[y];if(w!==t.movable.dropped[1]){var k=t.pieces[w],x=v[w];k?x?o(k,x)||(f.push(x),p.push(r(w,k,!1))):p.push(r(w,k,!1)):x&&f.push(x)}}return p.forEach(function(e){var t=a(e,f.filter(s.partial(o,e)));if(t){var n=g?t.pos:e.pos,r=g?e.pos:t.pos,d=[(n[0]-r[0])*i,(r[1]-n[1])*c];u[e.key]=[d,d],l.push(t.key)}}),f.forEach(function(e){e.key===t.movable.dropped[0]||s.containsX(l,e.key)||d.push({piece:{role:e.role,color:e.color},left:12.5*(g?e.pos[0]-1:8-e.pos[0])+"%",bottom:12.5*(g?e.pos[1]-1:8-e.pos[1])+"%",opacity:1})}),{anims:u,fadings:d}}function c(e,t){return Math.round(e*t)/t}function u(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(0>=t)e.animation.current={},e.render();else{var n=d.easeInOutCubic(t);for(var r in e.animation.current.anims){var o=e.animation.current.anims[r];o[1]=[c(o[0][0]*n,10),c(o[0][1]*n,10)]}for(var a in e.animation.current.fadings)e.animation.current.fadings[a].opacity=c(n,100);e.render(),s.requestAnimationFrame(function(){u(e)})}}}function l(e,t){var n={orientation:t.orientation,pieces:{}};for(var r in t.pieces)n.pieces[r]={role:t.pieces[r].role,color:t.pieces[r].color};var o=e(),a=i(n,t);if(Object.keys(a.anims).length>0||a.fadings.length>0){var c=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:a.anims,fadings:a.fadings},c||u(t)}else t.renderRAF();return o}var s=e("./util"),d={easeInOutCubic:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}};t.exports=function(e,t,n){return function(){var r=[t].concat(Array.prototype.slice.call(arguments,0));if(t.render){if(t.animation.enabled&&!n)return l(s.partialApply(e,r),t);var o=e.apply(null,r);return t.renderRAF(),o}return e.apply(null,r)}}},{"./util":16}],5:[function(e,t,n){var r=e("./board");t.exports=function(e){return{set:e.set,toggleOrientation:e.toggleOrientation,getOrientation:e.getOrientation,getPieces:function(){return e.data.pieces},getMaterialDiff:function(){return r.getMaterialDiff(e.data)},getFen:e.getFen,dump:function(){return e.data},move:e.apiMove,newPiece:e.apiNewPiece,setPieces:e.setPieces,setCheck:e.setCheck,playPremove:e.playPremove,playPredrop:e.playPredrop,cancelPremove:e.cancelPremove,cancelPredrop:e.cancelPredrop,cancelMove:e.cancelMove,stop:e.stop,explode:e.explode,setAutoShapes:e.setAutoShapes,setShapes:e.setShapes,data:e.data}}},{"./board":6}],6:[function(e,t,n){function r(e){setTimeout(e,1)}function o(e){e.orientation=L.opposite(e.orientation)}function a(e){e.lastMove=null,k(e,null),l(e),d(e)}function i(e,t){Object.keys(t).forEach(function(n){t[n]?e.pieces[n]=t[n]:delete e.pieces[n]}),e.movable.dropped=[]}function c(e,t){var n=t||e.turnColor;Object.keys(e.pieces).forEach(function(t){e.pieces[t].color===n&&"king"===e.pieces[t].role&&(e.check=t)})}function u(e,t,n){d(e),e.premovable.current=[t,n],r(L.partial(e.premovable.events.set,t,n))}function l(e){e.premovable.current&&(e.premovable.current=null,r(e.premovable.events.unset))}function s(e,t,n){l(e),e.predroppable.current={role:t,key:n},r(L.partial(e.predroppable.events.set,t,n))}function d(e){e.predroppable.current.key&&(e.predroppable.current={},r(e.predroppable.events.unset))}function f(e,t,n){if(e.autoCastle){var r=e.pieces[n];if("king"===r.role){var o=L.key2pos(t);if(5===o[0]&&(1===o[1]||8===o[1])){var a,i,c,u=L.key2pos(n);if(7===u[0]||8===u[0])a=L.pos2key([8,o[1]]),i=L.pos2key([6,o[1]]),c=L.pos2key([7,o[1]]);else{if(3!==u[0]&&1!==u[0])return;a=L.pos2key([1,o[1]]),i=L.pos2key([4,o[1]]),c=L.pos2key([3,o[1]])}delete e.pieces[t],delete e.pieces[n],delete e.pieces[a],e.pieces[c]={role:"king",color:r.color},e.pieces[i]={role:"rook",color:r.color}}}}}function p(e,t,n){var o=K(function(){if(t===n||!e.pieces[t])return!1;var o=e.pieces[n]&&e.pieces[n].color!==e.pieces[t].color?e.pieces[n]:null;return r(L.partial(e.events.move,t,n,o)),e.pieces[n]=e.pieces[t],delete e.pieces[t],e.lastMove=[t,n],e.check=null,f(e,t,n),r(e.events.change),!0},e)();return o&&(e.movable.dropped=[]),o}function h(e,t,n){return e.pieces[n]?!1:(r(L.partial(e.events.dropNewPiece,t,n)),e.pieces[n]=t,e.lastMove=[n,n],e.check=null,r(e.events.change),e.movable.dropped=[],e.movable.dests={},e.turnColor=L.opposite(e.turnColor),e.renderRAF(),!0)}function v(e,t,n){var r=p(e,t,n);return r&&(e.movable.dests={},e.turnColor=L.opposite(e.turnColor)),r}function g(e,t,n){return p(e,t,n)}function m(e,t,n){return h(e,t,n)}function b(e,t,n){if(n)if(C(e,t,n)){if(v(e,t,n)){var o=B.stop();return k(e,null),r(L.partial(e.movable.events.after,t,n,{premove:!1,holdTime:o})),!0}}else O(e,t,n)?(u(e,t,n),k(e,null)):x(e,n)||E(e,n)?(k(e,n),B.start()):k(e,null);else B.cancel(),k(e,null),"trash"===e.movable.dropOff&&(delete e.pieces[t],r(e.events.change))}function y(e,t,n){if(P(e,t,n)){var o=e.pieces[t];delete e.pieces[t],h(e,o,n),e.movable.dropped=[],r(L.partial(e.movable.events.afterNewPiece,o.role,n,{predrop:!1}))}else M(e,t,n)?s(e,e.pieces[t].role,n):(l(e),d(e));delete e.pieces[t],k(e,null)}function w(e,t){e.selected?t?e.selectable.enabled&&e.selected!==t?b(e,e.selected,t)&&(e.stats.dragged=!1):B.start():(k(e,null),B.cancel()):(x(e,t)||E(e,t))&&(k(e,t),B.start()),t&&r(L.partial(e.events.select,t))}function k(e,t){e.selected=t,e.premovable.dests=t&&E(e,t)?F(e.pieces,t,e.premovable.castle):null}function x(e,t){var n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function C(e,t,n){return t!==n&&x(e,t)&&(e.movable.free||L.containsX(e.movable.dests[t],n))}function P(e,t,n){var r=e.pieces[t];return r&&n&&(t===n||!e.pieces[n])&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function E(e,t){var n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function O(e,t,n){return t!==n&&E(e,t)&&L.containsX(F(e.pieces,t,e.premovable.castle),n)}function M(e,t,n){var r=e.pieces[t];return r&&n&&(!e.pieces[n]||e.pieces[n].color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===r.color&&e.turnColor!==r.color}function A(e,t){var n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function T(e){var t=e.premovable.current;if(t){var n=t[0],o=t[1],a=!1;return C(e,n,o)&&v(e,n,o)&&(r(L.partial(e.movable.events.after,n,o,{premove:!0})),a=!0),l(e),a}}function N(e,t){var n=e.predroppable.current,o=!1;if(n.key){if(t(n)){var a={role:n.role,color:e.movable.color};h(e,a,n.key)&&(r(L.partial(e.movable.events.afterNewPiece,n.role,n.key,{predrop:!0})),o=!0)}return d(e),o}}function S(e){l(e),d(e),w(e,null)}function j(e){e.movable.color=null,e.movable.dests={},S(e)}function D(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.ceil(8*((t[0]-n.left)/n.width));r="white"===e.orientation?r:9-r;var o=Math.ceil(8-8*((t[1]-n.top)/n.height));return o="white"===e.orientation?o:9-o,r>0&&9>r&&o>0&&9>o?L.pos2key([r,o]):void 0}}function R(e){var t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var n in e.pieces){var r=e.pieces[n];t[r.role]+="white"===r.color?1:-1}var o={white:{},black:{}};for(var a in t){var i=t[a];i>0?o.white[a]=i:0>i&&(o.black[a]=-i)}return o}function q(e){var t=0;for(var n in e.pieces)t+=I[e.pieces[n].role]*("white"===e.pieces[n].color?1:-1);return t}var L=e("./util"),F=e("./premove"),K=e("./anim"),B=e("./hold"),I={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0};t.exports={reset:a,toggleOrientation:o,setPieces:i,setCheck:c,selectSquare:w,setSelected:k,isDraggable:A,canMove:C,userMove:b,dropNewPiece:y,apiMove:g,apiNewPiece:m,playPremove:T,playPredrop:N,unsetPremove:l,unsetPredrop:d,cancelMove:S,stop:j,getKeyAtDomPos:D,getMaterialDiff:R,getScore:q}},{"./anim":4,"./hold":13,"./premove":14,"./util":16}],7:[function(e,t,n){var r=e("merge"),o=e("./board"),a=e("./fen");t.exports=function(e,t){t&&(t.movable&&t.movable.dests&&delete e.movable.dests,r.recursive(e,t),e.fen&&(e.pieces=a.read(e.fen),e.check=t.check,e.drawable.shapes=[],delete e.fen),e.check===!0&&o.setCheck(e),e.movable.dropped=[],e.selected&&o.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<10)&&(e.animation.enabled=!1))}},{"./board":6,"./fen":12,merge:2}],8:[function(e,t,n){var r=e("./board"),o=e("./data"),a=e("./fen"),i=e("./configure"),c=e("./anim"),u=e("./drag");t.exports=function(e){this.data=o(e),this.vm={exploding:!1},this.getFen=function(){return a.write(this.data.pieces)}.bind(this),this.getOrientation=function(){return this.data.orientation}.bind(this),this.set=c(i,this.data),this.toggleOrientation=c(r.toggleOrientation,this.data),this.setPieces=c(r.setPieces,this.data),this.selectSquare=c(r.selectSquare,this.data,!0),this.apiMove=c(r.apiMove,this.data),this.apiNewPiece=c(r.apiNewPiece,this.data),this.playPremove=c(r.playPremove,this.data),this.playPredrop=c(r.playPredrop,this.data),this.cancelPremove=c(r.unsetPremove,this.data,!0),this.cancelPredrop=c(r.unsetPredrop,this.data,!0),this.setCheck=c(r.setCheck,this.data,!0),this.cancelMove=c(function(e){r.cancelMove(e),u.cancel(e)}.bind(this),this.data,!0),this.stop=c(function(e){r.stop(e),u.cancel(e)}.bind(this),this.data,!0),this.explode=function(e){this.data.render&&(this.vm.exploding={stage:1,keys:e},this.data.renderRAF(),setTimeout(function(){this.vm.exploding.stage=2,this.data.renderRAF(),setTimeout(function(){this.vm.exploding=!1,this.data.renderRAF()}.bind(this),120)}.bind(this),120))}.bind(this),this.setAutoShapes=function(e){c(function(t){t.drawable.autoShapes=e},this.data,!1)()}.bind(this),this.setShapes=function(e){c(function(t){t.drawable.shapes=e},this.data,!1)()}.bind(this)}},{"./anim":4,"./board":6,"./configure":7,
"./data":9,"./drag":10,"./fen":12}],9:[function(e,t,n){var r=e("./fen"),o=e("./configure");t.exports=function(e){var t={pieces:r.read(r.initial),orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,render:null,renderRAF:null,element:null,bounds:null,autoCastle:!1,viewOnly:!1,minimalDom:!1,disableContextMenu:!1,resizable:!0,highlight:{lastMove:!0,check:!0,dragOver:!0},animation:{enabled:!0,duration:200,current:{}},movable:{free:!0,color:"both",dests:{},dropOff:"revert",dropped:[],showDests:!0,events:{after:function(e,t,n){},afterNewPiece:function(e,t){}}},premovable:{enabled:!0,showDests:!0,castle:!0,dests:[],current:null,events:{set:function(e,t){},unset:function(){}}},predroppable:{enabled:!1,current:{},events:{set:function(e,t){},unset:function(){}}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,current:{}},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{change:function(){},move:function(e,t,n){},dropNewPiece:function(e,t){},capture:function(e,t){},select:function(e){}},drawable:{enabled:!1,eraseOnClick:!0,onChange:function(e){},shapes:[],autoShapes:[],current:{},brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10,circleMargin:0},red:{key:"r",color:"#882020",opacity:1,lineWidth:10,circleMargin:1},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10,circleMargin:2},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10,circleMargin:3},paleBlue:{key:"pb",color:"#003088",opacity:.3,lineWidth:15,circleMargin:0},paleGreen:{key:"pg",color:"#15781B",opacity:.35,lineWidth:15,circleMargin:0}}}};return o(t,e||{}),t}},{"./configure":7,"./fen":12}],10:[function(e,t,n){function r(e){return e?e.color+e.role:""}function o(e,t,n){var r=f.key2pos(n);return"white"!==e.orientation&&(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}function a(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),s=t.target;var n=e.selected,a=f.eventPosition(t),c=e.bounds(),u=d.getKeyAtDomPos(e,a,c),l=!!e.premovable.current,h=!!e.predroppable.current.key;d.selectSquare(e,u);var v=e.selected===u,g=e.pieces[u];if(n||!e.drawable.eraseOnClick&&g&&g.color===e.turnColor||p.clear(e),g&&v&&d.isDraggable(e,u)){var m=o(e,c,u);e.draggable.current={previouslySelected:n,orig:u,piece:r(g),rel:a,epos:a,pos:[0,0],dec:e.draggable.centerPiece?[a[0]-(m.left+m.width/2),a[1]-(m.top+m.height/2)]:[0,0],bounds:c,started:e.draggable.autoDistance&&e.stats.dragged}}else l&&d.unsetPremove(e),h&&d.unsetPredrop(e);i(e)}}function i(e){f.requestAnimationFrame(function(){var t=e.draggable.current;t.orig&&(e.animation.current.start&&e.animation.current.anims[t.orig]&&(e.animation.current={}),r(e.pieces[t.orig])!==t.piece?l(e):(!t.started&&f.distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=d.getKeyAtDomPos(e,t.epos,t.bounds)))),e.render(),t.orig&&i(e)})}function c(e,t){t.touches&&t.touches.length>1||e.draggable.current.orig&&(e.draggable.current.epos=f.eventPosition(t))}function u(e,t){var n=e.draggable,r=n.current?n.current.orig:null;if(r){if(t&&"touchend"===t.type&&s!==t.target&&!n.current.newPiece)return void(n.current={});d.unsetPremove(e),d.unsetPredrop(e);var o=n.current.over;n.current.started&&(n.current.newPiece?d.dropNewPiece(e,r,o):(r!==o&&(e.movable.dropped=[r,o]),d.userMove(e,r,o)&&(e.stats.dragged=!0))),r!==n.current.previouslySelected||r!==o&&o?e.selectable.enabled||d.setSelected(e,null):d.setSelected(e,null),n.current={}}}function l(e){e.draggable.current.orig&&(e.draggable.current={},d.selectSquare(e,null))}var s,d=e("./board"),f=e("./util"),p=e("./draw");t.exports={start:a,move:c,end:u,cancel:l,processDrag:i}},{"./board":6,"./draw":11,"./util":16}],11:[function(e,t,n){function r(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),p.cancelMove(e);var n=h.eventPosition(t),r=e.bounds(),a=p.getKeyAtDomPos(e,n,r);e.drawable.current={orig:a,epos:n,bounds:r,brush:v[(t.shiftKey&h.isRightButton(t))+(t.altKey?2:0)]},o(e)}}function o(e){h.requestAnimationFrame(function(){var t=e.drawable.current;if(t.orig){var n=p.getKeyAtDomPos(e,t.epos,t.bounds);t.dest=t.orig===n?void 0:n}e.render(),t.orig&&o(e)})}function a(e,t){e.drawable.current.orig&&(e.drawable.current.epos=h.eventPosition(t))}function i(e,t){var n=e.drawable,r=n.current.orig,o=n.current.dest;r&&o?d(n,r,o):r&&s(n,r),n.current={},e.render()}function c(e){e.drawable.current.orig&&(e.drawable.current={})}function u(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.render(),f(e.drawable))}function l(e){return function(t){return!e(t)}}function s(e,t){var n=e.current.brush,r=function(e){return e.brush===n&&e.orig===t&&!e.dest},o=e.shapes.filter(r).length>0;o?e.shapes=e.shapes.filter(l(r)):e.shapes.push({brush:n,orig:t}),f(e)}function d(e,t,n){var r=e.current.brush,o=function(e){return e.orig&&e.dest&&(e.orig===t&&e.dest===n||e.dest===t&&e.orig===n)},a=e.shapes.filter(o).length>0;a?e.shapes=e.shapes.filter(l(o)):e.shapes.push({brush:r,orig:t,dest:n}),f(e)}function f(e){e.onChange(e.shapes)}var p=e("./board"),h=e("./util"),v=["green","red","blue","yellow"];t.exports={start:r,move:a,end:i,cancel:c,clear:u,processDraw:o}},{"./board":6,"./util":16}],12:[function(e,t,n){function r(e){"start"===e&&(e=i);var t={};return e.replace(/ .+$/,"").replace(/~/g,"").split("/").forEach(function(e,n){var r=0;e.split("").forEach(function(e){var o=parseInt(e);o?r+=o:(r++,t[a.pos2key([r,8-n])]={role:c[e.toLowerCase()],color:e===e.toLowerCase()?"black":"white"})})}),t}function o(e){return[8,7,6,5,4,3,2].reduce(function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),t)},a.invRanks.map(function(t){return a.ranks.map(function(n){var r=e[a.pos2key([n,t])];if(r){var o=u[r.role];return"white"===r.color?o.toUpperCase():o}return"1"}).join("")}).join("/"))}var a=e("./util"),i="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",c={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},u={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};t.exports={initial:i,read:r,write:o}},{"./util":16}],13:[function(e,t,n){var r,o=function(){r=new Date},a=function(){r=null},i=function(){if(!r)return 0;var e=new Date-r;return r=null,e};t.exports={start:o,cancel:a,stop:i}},{}],14:[function(e,t,n){function r(e,t){return Math.abs(e-t)}function o(e,t,n,o,a){return r(t,o)<2&&("white"===e?a===n+1||2>=n&&a===n+2&&t===o:a===n-1||n>=7&&a===n-2&&t===o)}function a(e,t,n,o){var a=r(e,n),i=r(t,o);return 1===a&&2===i||2===a&&1===i}function i(e,t,n,o){return r(e,n)===r(t,o)}function c(e,t,n,r){return e===n||t===r}function u(e,t,n,r){return i(e,t,n,r)||c(e,t,n,r)}function l(e,t,n,o,a,i,c){return r(o,i)<2&&r(a,c)<2||n&&a===c&&a===("white"===e?1:8)&&(5===o&&(3===i||7===i)||f.containsX(t,i))}function s(e,t){return Object.keys(e).filter(function(n){var r=e[n];return r&&r.color===t&&"rook"===r.role}).map(function(e){return f.key2pos(e)[0]})}function d(e,t,n){var r,d=e[t],p=f.key2pos(t);switch(d.role){case"pawn":r=o.bind(null,d.color);break;case"knight":r=a;break;case"bishop":r=i;break;case"rook":r=c;break;case"queen":r=u;break;case"king":r=l.bind(null,d.color,s(e,d.color),n)}return f.allPos.filter(function(e){return(p[0]!==e[0]||p[1]!==e[1])&&r(p[0],p[1],e[0],e[1])}).map(f.pos2key)}var f=e("./util");t.exports=d},{"./util":16}],15:[function(e,t,n){function r(e,t){return(e?2:4)/512*t.width}function o(e,t,n){return(e.lineWidth||10)*(t?.7:1)/512*n.width}function a(e,t){return(e.opacity||1)*(t?.6:1)}function i(e,t){return h()?0:(e?10:20)/512*t.width}function c(e,t){var n=t.width/8;return[(e[0]-.5)*n,(8.5-e[1])*n]}function u(e,t,n,o){var i=c(t,o),u=r(n,o),l=o.width/16;return{tag:"circle",attrs:{key:n?"current":t+e.key,stroke:e.color,"stroke-width":u,fill:"none",opacity:a(e,n),cx:i[0],cy:i[1],r:l-u/2-e.circleMargin*u*1.5}}}function l(e,t,n,r,u){var l=i(r,u),s=c(t,u),d=c(n,u),f=d[0]-s[0],p=d[1]-s[1],v=Math.atan2(p,f),g=Math.cos(v)*l,m=Math.sin(v)*l;return{tag:"line",attrs:{key:r?"current":t+n+e.key,stroke:e.color,"stroke-width":o(e,r,u),"stroke-linecap":"round","marker-end":h()?null:"url(#arrowhead-"+e.key+")",opacity:a(e,r),x1:s[0],y1:s[1],x2:d[0]-g,y2:d[1]-m}}}function s(e){return{tag:"defs",children:[e.map(function(e){return{key:e.key,tag:"marker",attrs:{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01},children:[{tag:"path",attrs:{d:"M0,0 V4 L3,2 Z",fill:e.color}}]}})]}}function d(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function f(e,t,n,r){return function(o){return o.orig&&o.dest?l(n[o.brush],d(p(o.orig),e),d(p(o.dest),e),t,r):o.orig?u(n[o.brush],d(p(o.orig),e),t,r):void 0}}var p=(e("mithril"),e("./util").key2pos),h=e("./util").isTrident;t.exports=function(e){if(e.data.bounds){var t=e.data.drawable,n=t.shapes.concat(t.autoShapes);if(n.length||t.current.orig){var r=e.data.bounds();if(r.width===r.height){var o=Object.keys(e.data.drawable.brushes).filter(function(e){return t.current&&t.current.dest&&t.current.brush===e||n.filter(function(t){return t.dest&&t.brush===e}).length}).map(function(t){return e.data.drawable.brushes[t]});return{tag:"svg",children:[s(o),n.map(f(e.data.orientation,!1,e.data.drawable.brushes,r)),f(e.data.orientation,!0,e.data.drawable.brushes,r)(t.current)]}}}}}},{"./util":16,mithril:3}],16:[function(e,t,n){function r(e){return k[e[0]-1]+e[1]}function o(e){return[k.indexOf(e[0])+1,parseInt(e[1])]}function a(e){return k[7-k.indexOf(e[0])]+(9-parseInt(e[1]))}function i(e){var t=[];for(var n in e)e[n]&&t.push(n);return t.join(" ")}function c(e){return"white"===e?"black":"white"}function u(e,t){return e&&(e[0]===t||e[1]===t)}function l(e,t){return e&&-1!==e.indexOf(t)}function s(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function d(){return"transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"}function f(){return w||(w=d()),w}function p(){return null===M&&(M=window.navigator.userAgent.indexOf("Trident/")>-1),M}function h(e){return"translate("+e[0]+"px,"+e[1]+"px)"}function v(e){return e.touches?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:[e.clientX,e.clientY]}function g(e,t){return e.bind.apply(e,[null].concat(t))}function m(){return g(arguments[0],Array.prototype.slice.call(arguments,1))}function b(e){return 2===e.buttons||2===e.button}function y(e){var t,n=function(){return void 0===t&&(t=e()),t};return n.clear=function(){t=void 0},n}var w,k="abcdefgh".split(""),x=[1,2,3,4,5,6,7,8],C=[8,7,6,5,4,3,2,1],P=function(){var e=[];return C.forEach(function(t){x.forEach(function(n){e.push([n,t])})}),e}(),E=P.slice().reverse(),O=P.map(r),M=null;t.exports={files:k,ranks:x,invRanks:C,allPos:P,invPos:E,allKeys:O,pos2key:r,key2pos:o,invertKey:a,classSet:i,opposite:c,translate:h,contains2:u,containsX:l,distance:s,eventPosition:v,partialApply:g,partial:m,transformProp:f,isTrident:p,requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),isRightButton:b,memo:y}},{}],17:[function(e,t,n){function r(e){return e.role+" "+e.color}function o(e,t,n){var o={style:{},"class":r(n)},a=e.data.draggable.current;if(a.orig===t&&a.started)o.style[v.transformProp()]=v.translate([a.pos[0]+a.dec[0],a.pos[1]+a.dec[1]]),o["class"]+=" dragging";else if(e.data.animation.current.anims){var i=e.data.animation.current.anims[t];i&&(o.style[v.transformProp()]=v.translate(i[1]))}return{tag:"piece",attrs:o}}function a(e){return{tag:"piece",attrs:{"class":r(e)+" ghost"}}}function i(e,t,n){var r=e.data,i=v.files[t[0]-1],c=t[1],u=i+c,l=r.pieces[u],s=r.highlight.dragOver&&r.draggable.current.over===u,d=v.classSet({selected:r.selected===u,check:r.highlight.check&&r.check===u,"last-move":r.highlight.lastMove&&v.contains2(r.lastMove,u),"move-dest":(s||r.movable.showDests)&&v.containsX(r.movable.dests[r.selected],u),"premove-dest":(s||r.premovable.showDests)&&v.containsX(r.premovable.dests,u),"current-premove":u===r.predroppable.current.key||v.contains2(r.premovable.current,u),"drag-over":s,oc:!!l});e.vm.exploding&&-1!==e.vm.exploding.keys.indexOf(u)&&(d+=" exploding"+e.vm.exploding.stage);var f={style:{left:12.5*(n?t[0]-1:8-t[0])+"%",bottom:12.5*(n?t[1]-1:8-t[1])+"%"}};d&&(f["class"]=d),r.coordinates&&(t[1]===(n?1:8)&&(f["data-coord-x"]=i),t[0]===(n?8:1)&&(f["data-coord-y"]=c));var p=[];return l&&(p.push(o(e,u,l)),r.draggable.current.orig===u&&r.draggable.showGhost&&!r.draggable.current.newPiece&&p.push(a(l))),{tag:"square",attrs:f,children:p}}function c(e){return{tag:"square",attrs:{"class":"fading",style:{left:e.left,bottom:e.bottom,opacity:e.opacity}},children:[{tag:"piece",attrs:{"class":r(e.piece)}}]}}function u(e,t){var n=[];e.data.lastMove&&e.data.lastMove.forEach(function(e){var r=v.key2pos(e);n.push({tag:"square",attrs:{"class":"last-move",style:{left:12.5*(t?r[0]-1:8-r[0])+"%",bottom:12.5*(t?r[1]-1:8-r[1])+"%"}}})});for(var o=Object.keys(e.data.pieces),a=0,i=o.length;i>a;a++){var c=o[a],u=v.key2pos(c),l={style:{left:12.5*(t?u[0]-1:8-u[0])+"%",bottom:12.5*(t?u[1]-1:8-u[1])+"%"},"class":r(e.data.pieces[c])};if(e.data.animation.current.anims){var s=e.data.animation.current.anims[c];s&&(l.style[v.transformProp()]=v.translate(s[1]))}n.push({tag:"piece",attrs:l})}return n}function l(e){var t="white"===e.data.orientation;if(e.data.minimalDom)return u(e,t);for(var n=t?v.allPos:v.invPos,r=[],o=0,a=n.length;a>o;o++)r.push(i(e,n[o],t));return e.data.animation.current.fadings&&e.data.animation.current.fadings.forEach(function(e){r.push(c(e))}),e.data.drawable.enabled&&r.push(g(e)),r}function s(e,t,n){return function(r){v.isRightButton(r)&&e.draggable.current.orig?(e.draggable.current.newPiece&&delete e.pieces[e.draggable.current.orig],e.draggable.current={},e.selected=null):e.drawable.enabled&&(r.shiftKey||v.isRightButton(r))?n(e,r):e.viewOnly||t(e,r)}}function d(e,t,n){var r=e.data,o=s(r,p.start,h.start),a=s(r,p.move,h.move),i=s(r,p.end,h.end),c=["touchstart","mousedown"],u=["touchmove","mousemove"],l=["touchend","mouseup"];c.forEach(function(e){t.addEventListener(e,o)}),u.forEach(function(e){document.addEventListener(e,a)}),l.forEach(function(e){document.addEventListener(e,i)}),n.onunload=function(){c.forEach(function(e){t.removeEventListener(e,o)}),u.forEach(function(e){document.removeEventListener(e,a)}),l.forEach(function(e){document.removeEventListener(e,i)})}}function f(e){return{tag:"div",attrs:{"class":"cg-board orientation-"+e.data.orientation,config:function(t,n,r){n||((!e.data.viewOnly||e.data.drawable.enabled)&&d(e,t,r),e.data.render=function(){m.render(t,l(e))},e.data.renderRAF=function(){v.requestAnimationFrame(e.data.render)},e.data.bounds=v.memo(t.getBoundingClientRect.bind(t)),e.data.element=t,e.data.render())}},children:[]}}var p=e("./drag"),h=e("./draw"),v=e("./util"),g=e("./svg"),m=e("mithril");t.exports=function(e){return{tag:"div",attrs:{config:function(t,n){n||(t.addEventListener("contextmenu",function(t){return e.data.disableContextMenu||e.data.drawable.enabled?(t.preventDefault(),!1):void 0}),e.data.resizable&&document.body.addEventListener("chessground.resize",function(t){e.data.bounds.clear(),e.data.render()},!1),["onscroll","onresize"].forEach(function(t){var n=window[t];window[t]=function(){n&&n(),e.data.bounds.clear()}}))},"class":["cg-board-wrap",e.data.viewOnly?"view-only":"manipulable",e.data.minimalDom?"minimal-dom":"full-dom"].join(" ")},children:[f(e)]}}},{"./drag":10,"./draw":11,"./svg":15,"./util":16,mithril:3}]},{},[1])(1)});