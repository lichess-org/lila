!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Chessground=e()}}(function(){var e;return function t(e,n,r){function o(a,c){if(!n[a]){if(!e[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n?n:t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){function r(e,t){var n=new i(t);return o.render(e,a(n)),c(n)}var o=e("mithril"),i=e("./ctrl"),a=e("./view"),c=e("./api");t.exports=r,t.exports.controller=i,t.exports.view=a,t.exports.fen=e("./fen"),t.exports.util=e("./util"),t.exports.configure=e("./configure"),t.exports.anim=e("./anim"),t.exports.board=e("./board"),t.exports.drag=e("./drag")},{"./anim":4,"./api":5,"./board":6,"./configure":7,"./ctrl":9,"./drag":11,"./fen":13,"./util":17,"./view":18,mithril:3}],2:[function(e,t,n){!function(e){function n(e,t){if("object"!==o(e))return t;for(var r in t)e[r]="object"===o(e[r])&&"object"===o(t[r])?n(e[r],t[r]):t[r];return e}function r(e,t,r){var a=r[0],c=r.length;(e||"object"!==o(a))&&(a={});for(var s=0;c>s;++s){var u=r[s],l=o(u);if("object"===l)for(var d in u){var f=e?i.clone(u[d]):u[d];a[d]=t?n(a[d],f):f}}return a}function o(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var i=function(e){return r(e===!0,!1,arguments)},a="merge";i.recursive=function(e){return r(e===!0,!0,arguments)},i.clone=function(e){var t,n,r=e,a=o(e);if("array"===a)for(r=[],n=e.length,t=0;n>t;++t)r[t]=i.clone(e[t]);else if("object"===a){r={};for(t in e)r[t]=i.clone(e[t])}return r},e?t.exports=i:window[a]=i}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)},{}],3:[function(t,n,r){var o=function i(e,t){"use strict";function n(e){return"function"==typeof e}function r(e){return"[object Object]"===ge.call(e)}function o(e){return"[object String]"===ge.call(e)}function a(e){le=e.document,de=e.location,pe=e.cancelAnimationFrame||e.clearTimeout,fe=e.requestAnimationFrame||e.setTimeout}function c(e,t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(r(e))return H(e,n);var a,c=null!=t&&r(t)&&!("tag"in t||"view"in t||"subtree"in t),s=c?t:{},u="class"in s?"class":"className",l={tag:"div",attrs:{}},d=[];if(!o(e))throw new Error("selector in m(selector, attrs, children) should be a string");for(;null!=(a=me.exec(e));)if(""===a[1]&&a[2])l.tag=a[2];else if("#"===a[1])l.attrs.id=a[2];else if("."===a[1])d.push(a[2]);else if("["===a[3][0]){var f=be.exec(a[3]);l.attrs[f[1]]=f[3]||(f[2]?"":!0)}var p=c?n.slice(1):n;l.children=1===p.length&&ve(p[0])?p[0]:p;for(var h in s)s.hasOwnProperty(h)&&(h===u&&null!=s[h]&&""!==s[h]?(d.push(s[h]),l.attrs[h]=""):l.attrs[h]=s[h]);return d.length&&(l.attrs[u]=d.join(" ")),l}function s(e,t){for(var n=0;n<e.length&&!t(e[n],n++););}function u(e,t){s(e,function(e,n){return(e=e&&e.attrs)&&null!=e.key&&t(e,n)})}function l(e){return null==e?"":"object"==typeof e?e:null==e.toString()?"":e}function d(e,t,n,r){try{p(e,t,n),t.nodeValue=r}catch(o){}}function f(e){for(var t=0;t<e.length;t++)ve(e[t])&&(e=e.concat.apply([],e),t--);return e}function p(e,t,n){e.insertBefore(t,e.childNodes[n]||null)}function h(e,t,n,r){u(e,function(e,r){t[e=e.key]=t[e]?{action:Ee,index:r,from:t[e].index,element:n.nodes[t[e].index]||le.createElement("div")}:{action:Ce,index:r}});var o=[];for(var i in t)o.push(t[i]);var a=o.sort(B),c=new Array(n.length);return c.nodes=n.nodes.slice(),s(a,function(t){var o=t.index;if(t.action===xe&&(W(n[o].nodes,n[o]),c.splice(o,1)),t.action===Ce){var i=le.createElement("div");i.key=e[o].attrs.key,p(r,i,o),c.splice(o,0,{attrs:{key:e[o].attrs.key},nodes:[i]}),c.nodes[o]=i}if(t.action===Ee){var a=t.element,s=r.childNodes[o];s!==a&&null!==a&&r.insertBefore(a,s||null),c[o]=n[t.from],c.nodes[o]=a}}),c}function v(e,t,n,r){var o=e.length!==t.length;return o||u(e,function(e,n){var r=t[n];return o=r&&r.attrs&&r.attrs.key!==e.key}),o?h(e,n,t,r):t}function g(e,t,n){s(e,function(e,r){null!=t[r]&&n.push.apply(n,t[r].nodes)}),s(t.nodes,function(e,r){null!=e.parentNode&&n.indexOf(e)<0&&W([e],[t[r]])}),e.length<t.length&&(t.length=e.length),t.nodes=n}function m(e){var t=0;u(e,function(){return s(e,function(e){(e=e&&e.attrs)&&null==e.key&&(e.key="__mithril__"+t++)}),1})}function b(e,t,r){(e.tag!==t.tag||r.sort().join()!==Object.keys(t.attrs).sort().join()||e.attrs.id!==t.attrs.id||e.attrs.key!==t.attrs.key||"all"===c.redraw.strategy()&&(!t.configContext||t.configContext.retain!==!0)||"diff"===c.redraw.strategy()&&t.configContext&&t.configContext.retain===!1)&&(t.nodes.length&&W(t.nodes),t.configContext&&n(t.configContext.onunload)&&t.configContext.onunload(),t.controllers&&s(t.controllers,function(e){e.unload&&e.onunload({preventDefault:we})}))}function y(e,t){return e.attrs.xmlns?e.attrs.xmlns:"svg"===e.tag?"http://www.w3.org/2000/svg":"math"===e.tag?"http://www.w3.org/1998/Math/MathML":t}function w(e,t,n){n.length&&(e.views=t,e.controllers=n,s(n,function(e){if(e.onunload&&e.onunload.$old&&(e.onunload=e.onunload.$old),We&&e.onunload){var t=e.onunload;e.onunload=we,e.onunload.$old=t}}))}function k(e,t,r,o,i){if(n(t.attrs.config)){var a=i.configContext=i.configContext||{};e.push(function(){return t.attrs.config.call(t,r,!o,a,i)})}}function x(e,n,r,o,i,a,c,s){var u=e.nodes[0];return o&&U(u,n.tag,n.attrs,e.attrs,i),e.children=L(u,n.tag,t,t,n.children,e.children,!1,0,n.attrs.contenteditable?u:r,i,c),e.nodes.intact=!0,s.length&&(e.views=a,e.controllers=s),u}function C(e,t,n){var r;e.$trusted?r=z(t,n,e):(r=[le.createTextNode(e)],t.nodeName.match(ye)||p(t,r[0],n));var o="string"==typeof e||"number"==typeof e||"boolean"==typeof e?new e.constructor(e):e;return o.nodes=r,o}function E(e,t,n,r,o,i){var a=t.nodes;return r&&r===le.activeElement||(e.$trusted?(W(a,t),a=z(n,o,e)):"textarea"===i?n.value=e:r?r.innerHTML=e:((1===a[0].nodeType||a.length>1)&&(W(t.nodes,t),a=[le.createTextNode(e)]),d(n,a[0],o,e))),t=new e.constructor(e),t.nodes=a,t}function P(e,t,n,r,o,i,a){return 0===e.nodes.length?C(t,r,n):e.valueOf()!==t.valueOf()||o===!0?E(t,e,r,i,n,a):(e.nodes.intact=!0,e)}function M(e){if(e.$trusted){var t=e.match(/<[^\/]|\>\s*[^<]/g);if(null!=t)return t.length}else if(ve(e))return e.length;return 1}function O(e,n,r,o,i,a,c,s,l){e=f(e);var d=[],p=n.length===e.length,h=0,b={},y=!1;u(n,function(e,t){y=!0,b[n[t].attrs.key]={action:xe,index:t}}),m(e),y&&(n=v(e,n,b,r));for(var w=0,k=0,x=e.length;x>k;k++){var C=L(r,i,n,o,e[k],n[w],a,o+h||h,c,s,l);C!==t&&(p=p&&C.nodes.intact,h+=M(C),n[w++]=C)}return p||g(e,n,d),n}function A(e,t,n,r,o){if(null!=t){if(ge.call(t)===ge.call(e))return t;if(o&&o.nodes){var i=n-r,a=i+(ve(e)?e:t.nodes).length;W(o.nodes.slice(i,a),o.slice(i,a))}else t.nodes&&W(t.nodes,t)}return t=new e.constructor,t.tag&&(t={}),t.nodes=[],t}function T(e,n){return n===t?e.attrs.is?le.createElement(e.tag,e.attrs.is):le.createElement(e.tag):e.attrs.is?le.createElementNS(n,e.tag,e.attrs.is):le.createElementNS(n,e.tag)}function N(e,t,n,r){return r?U(t,e.tag,e.attrs,{},n):e.attrs}function j(e,n,r,o,i,a){return null!=e.children&&e.children.length>0?L(n,e.tag,t,t,e.children,r.children,!0,0,e.attrs.contenteditable?n:o,i,a):e.children}function S(e,t,n,r,o,i,a){var c={tag:e.tag,attrs:t,children:n,nodes:[r]};return w(c,i,a),c.children&&!c.children.nodes&&(c.children.nodes=[]),"select"===e.tag&&"value"in e.attrs&&U(r,e.tag,{value:e.attrs.value},{},o),c}function R(e,t,n,r){var o="diff"===c.redraw.strategy()&&e?e.indexOf(t):-1;return o>-1?n[o]:"function"==typeof r?new r:{}}function D(e,t,n,r){null!=r.onunload&&Fe.push({controller:r,handler:r.onunload}),e.push(n),t.push(r)}function q(e,t,n,r,o,i){var a=R(n.views,t,r,e.controller),c=+(e&&e.attrs&&e.attrs.key);return e=0===We||Ue||r&&r.indexOf(a)>-1?e.view(a):{tag:"placeholder"},"retain"===e.subtree?n:(c===c&&((e.attrs=e.attrs||{}).key=c),D(i,o,t,a),e)}function K(e,t,n,r){for(var o=t&&t.controllers;null!=e.view;)e=q(e,e.view.$original||e.view,t,o,r,n);return e}function F(e,t,n,r,i,a,c,s){var u=[],l=[];if(e=K(e,t,u,l),!e.tag&&l.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");e.attrs=e.attrs||{},t.attrs=t.attrs||{};var d=Object.keys(e.attrs),f=d.length>("key"in e.attrs?1:0);if(b(e,t,d),o(e.tag)){var h=0===t.nodes.length;c=y(e,c);var v;if(h){v=T(e,c);var g=N(e,v,c,f),m=j(e,v,t,n,c,s);t=S(e,g,m,v,c,u,l)}else v=x(t,e,n,f,c,u,s,l);return(h||a===!0&&null!=v)&&p(r,v,i),k(s,e,v,h,t),t}}function L(e,t,o,i,a,c,s,u,d,f,p){return a=l(a),"retain"===a.subtree?c:(c=A(a,c,u,i,o),ve(a)?O(a,c,e,u,t,s,d,f,p):null!=a&&r(a)?F(a,c,d,e,u,s,f,p):n(a)?c:P(c,a,u,e,s,d,t))}function B(e,t){return e.action-t.action||e.index-t.index}function U(e,t,o,i,a){for(var c in o){var s=o[c],u=i[c];if(c in i&&u===s)"value"===c&&"input"===t&&e.value!=s&&(e.value=s);else{if(i[c]=s,"config"===c||"key"===c)continue;if(n(s)&&"on"===c.slice(0,2))e[c]=$(s,e);else if("style"===c&&null!=s&&r(s)){for(var l in s)(null==u||u[l]!==s[l])&&(e.style[l]=s[l]);for(var l in u)l in s||(e.style[l]="")}else null!=a?"href"===c?e.setAttributeNS("http://www.w3.org/1999/xlink","href",s):e.setAttribute("className"===c?"class":c,s):c in e&&"list"!==c&&"style"!==c&&"form"!==c&&"type"!==c&&"width"!==c&&"height"!==c?("input"!==t||e[c]!==s)&&(e[c]=s):e.setAttribute(c,s)}}return i}function W(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(r){}t=[].concat(t),t[n]&&I(t[n])}e.length&&(e.length=0)}function I(e){e.configContext&&n(e.configContext.onunload)&&(e.configContext.onunload(),e.configContext.onunload=null),e.controllers&&s(e.controllers,function(e){n(e.onunload)&&e.onunload({preventDefault:we})}),e.children&&(ve(e.children)?s(e.children,I):e.children.tag&&I(e.children))}function z(e,t,n){var r=e.childNodes[t];if(r){var o=1!==r.nodeType,i=le.createElement("span");o?(e.insertBefore(i,r||null),i.insertAdjacentHTML("beforebegin",n),e.removeChild(i)):r.insertAdjacentHTML("beforebegin",n)}else Pe(e,n);for(var a=[];e.childNodes[t]!==r;)a.push(e.childNodes[t]),t++;return a}function $(e,t){return function(n){n=n||event,c.redraw.strategy("diff"),c.startComputation();try{return e.call(t,n)}finally{Y()}}}function X(e){var t=Oe.indexOf(e);return 0>t?Oe.push(e)-1:t}function G(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}function H(e,t){var n=function(){return(e.controller||we).apply(this,t)||this};e.controller&&(n.prototype=e.controller.prototype);var r=function(n){var r=arguments.length>1?t.concat([].slice.call(arguments,1)):t;return e.view.apply(e,r?[n].concat(r):[n])};r.$original=e.view;var o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o}function _(e,t){Ne.splice(t,1),Se.splice(t,1),je.splice(t,1),re(e),Oe.splice(X(e),1)}function J(){qe&&(qe(),qe=null),s(Ne,function(e,t){var n=je[t];if(Se[t]){var r=[Se[t]];c.render(e,n.view?n.view(Se[t],r):"")}}),Ke&&(Ke(),Ke=null),Re=null,De=new Date,c.redraw.strategy("diff")}function Y(){"none"===c.redraw.strategy()?(We--,c.redraw.strategy("diff")):c.endComputation()}function V(e){return e.slice($e[c.route.mode].length)}function Q(e,t,n){Ie={};var r=n.indexOf("?");-1!==r&&(Ie=ne(n.substr(r+1,n.length)),n=n.substr(0,r));var o=Object.keys(t),i=o.indexOf(n);if(-1!==i)return c.mount(e,t[o[i]]),!0;for(var a in t){if(a===n)return c.mount(e,t[a]),!0;var u=new RegExp("^"+a.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(u.test(n))return n.replace(u,function(){var n=a.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2);s(n,function(e,t){Ie[e.replace(/:|\./g,"")]=decodeURIComponent(r[t])}),c.mount(e,t[a])}),!0}}function Z(e){if(e=e||event,!e.ctrlKey&&!e.metaKey&&2!==e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;for(var t=e.currentTarget||e.srcElement,n="pathname"===c.route.mode&&t.search?ne(t.search.slice(1)):{};t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;c.route(t[c.route.mode].slice($e[c.route.mode].length),n)}}function ee(){"hash"!==c.route.mode&&de.hash?de.hash=de.hash:e.scrollTo(0,0)}function te(e,n){var o={},i=[];for(var a in e){var c=n?n+"["+a+"]":a,u=e[a];if(null===u)i.push(encodeURIComponent(c));else if(r(u))i.push(te(u,c));else if(ve(u)){var l=[];o[c]=o[c]||{},s(u,function(e){o[c][e]||(o[c][e]=!0,l.push(encodeURIComponent(c)+"="+encodeURIComponent(e)))}),i.push(l.join("&"))}else u!==t&&i.push(encodeURIComponent(c)+"="+encodeURIComponent(u))}return i.join("&")}function ne(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));var t=e.split("&"),n={};return s(t,function(e){var t=e.split("="),r=decodeURIComponent(t[0]),o=2===t.length?decodeURIComponent(t[1]):null;null!=n[r]?(ve(n[r])||(n[r]=[n[r]]),n[r].push(o)):n[r]=o}),n}function re(e){var n=X(e);W(e.childNodes,Ae[n]),Ae[n]=t}function oe(e,t){var n=c.prop(t);return e.then(n),n.then=function(n,r){return oe(e.then(n,r),t)},n["catch"]=n.then.bind(null,null),n["finally"]=function(e){var r=function(){return c.deferred().resolve(e()).promise};return n.then(function(e){return oe(r().then(function(){return e}),t)},function(e){return oe(r().then(function(){throw new Error(e)}),t)})},n}function ie(e,t){function o(e){p=e||d,v.map(function(e){p===l?e.resolve(h):e.reject(h)})}function i(e,t,o,i){if((null!=h&&r(h)||n(h))&&n(e))try{var a=0;e.call(h,function(e){a++||(h=e,t())},function(e){a++||(h=e,o())})}catch(s){c.deferred.onerror(s),h=s,o()}else i()}function a(){var r;try{r=h&&h.then}catch(d){return c.deferred.onerror(d),h=d,p=u,a()}i(r,function(){p=s,a()},function(){p=u,a()},function(){try{p===s&&n(e)?h=e(h):p===u&&n(t)&&(h=t(h),p=s)}catch(a){return c.deferred.onerror(a),h=a,o()}h===f?(h=TypeError(),o()):i(r,function(){o(l)},o,function(){o(p===s&&l)})})}var s=1,u=2,l=3,d=4,f=this,p=0,h=0,v=[];f.promise={},f.resolve=function(e){return p||(h=e,p=s,a()),this},f.reject=function(e){return p||(h=e,p=u,a()),this},f.promise.then=function(e,t){var n=new ie(e,t);return p===l?n.resolve(h):p===d?n.reject(h):v.push(n),n.promise}}function ae(e){return e}function ce(r){if(!r.dataType||"jsonp"!==r.dataType.toLowerCase()){var i=new e.XMLHttpRequest;if(i.open(r.method,r.url,!0,r.user,r.password),i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<300?r.onload({type:"load",target:i}):r.onerror({type:"error",target:i}))},r.serialize===JSON.stringify&&r.data&&"GET"!==r.method&&i.setRequestHeader("Content-Type","application/json; charset=utf-8"),r.deserialize===JSON.parse&&i.setRequestHeader("Accept","application/json, text/*"),n(r.config)){var a=r.config(i,r);null!=a&&(i=a)}var c="GET"!==r.method&&r.data?r.data:"";if(c&&!o(c)&&c.constructor!==e.FormData)throw new Error("Request data should be either be a string or FormData. Check the `serialize` option in `m.request`");return i.send(c),i}var s="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),u=le.createElement("script");e[s]=function(n){u.parentNode.removeChild(u),r.onload({type:"load",target:{responseText:n}}),e[s]=t},u.onerror=function(){return u.parentNode.removeChild(u),r.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),e[s]=t,!1},u.onload=function(){return!1},u.src=r.url+(r.url.indexOf("?")>0?"&":"?")+(r.callbackKey?r.callbackKey:"callback")+"="+s+"&"+te(r.data||{}),le.body.appendChild(u)}function se(e,t,n){if("GET"===e.method&&"jsonp"!==e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=te(t);e.url=e.url+(o?r+o:"")}else e.data=n(t);return e}function ue(e,t){var n=e.match(/:[a-z]\w+/gi);return n&&t&&s(n,function(n){var r=n.slice(1);e=e.replace(n,t[r]),delete t[r]}),e}var le,de,fe,pe,he="v0.2.1",ve=Array.isArray||function(e){return"[object Array]"===ge.call(e)},ge={}.toString,me=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,be=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,ye=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/,we=function(){};a(e),c.version=function(){return he};var ke,xe=1,Ce=2,Ee=3,Pe=function(){var e=function(e,t){e.appendChild(le.createRange().createContextualFragment(t))},t=function(e,t){e.insertAdjacentHTML("beforeend",t)};try{return le.createRange().createContextualFragment("x"),e}catch(n){return t}}(),Me={appendChild:function(e){ke===t&&(ke=le.createElement("html")),le.documentElement&&le.documentElement!==e?le.replaceChild(e,le.documentElement):le.appendChild(e),this.childNodes=le.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},Oe=[],Ae={};c.render=function(e,n,r){var o=[];if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var i=X(e),a=e===le,c=a||e===le.documentElement?Me:e;a&&"html"!==n.tag&&(n={tag:"html",attrs:{},children:n}),Ae[i]===t&&W(c.childNodes),r===!0&&re(e),Ae[i]=L(c,null,t,t,n,Ae[i],!1,0,null,t,o),s(o,function(e){e()})},c.trust=function(e){return e=new String(e),e.$trusted=!0,e},c.prop=function(e){return(null!=e&&r(e)||n(e))&&n(e.then)?oe(e):G(e)};var Te,Ne=[],je=[],Se=[],Re=null,De=0,qe=null,Ke=null,Fe=[],Le=16;c.component=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);return H(e,t)},c.mount=c.module=function(e,t){if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var r=Ne.indexOf(e);0>r&&(r=Ne.length);var o=!1,i={preventDefault:function(){o=!0,qe=Ke=null}};s(Fe,function(e){e.handler.call(e.controller,i),e.controller.onunload=null}),o?s(Fe,function(e){e.controller.onunload=e.handler}):Fe=[],Se[r]&&n(Se[r].onunload)&&Se[r].onunload(i);var a=null===t;if(!o){c.redraw.strategy("all"),c.startComputation(),Ne[r]=e;var u=Te=t?t:t={controller:we},l=new(t.controller||we);return u===Te&&(Se[r]=l,je[r]=t),Y(),a&&_(e,r),Se[r]}a&&_(e,r)};var Be=!1,Ue=!1;c.redraw=function(t){if(!Be){Be=!0,t&&(Ue=!0);try{Re&&!t?(fe===e.requestAnimationFrame||new Date-De>Le)&&(Re>0&&pe(Re),Re=fe(J,Le)):(J(),Re=fe(function(){Re=null},Le))}finally{Be=Ue=!1}}},c.redraw.strategy=c.prop();var We=0;c.startComputation=function(){We++},c.endComputation=function(){We>1?We--:(We=0,c.redraw())},c.withAttr=function(e,t,n){return function(r){r=r||event;var o=r.currentTarget||this,i=n||this;t.call(i,e in o?o[e]:o.getAttribute(e))}};var Ie,ze,$e={pathname:"",hash:"#",search:"?"},Xe=we,Ge=!1;return c.route=function(t,n,r,i){if(0===arguments.length)return ze;if(3===arguments.length&&o(n)){Xe=function(e){var o=ze=V(e);if(!Q(t,r,o)){if(Ge)throw new Error("Ensure the default route matches one of the routes defined in m.route");Ge=!0,c.route(n,!0),Ge=!1}};var a="hash"===c.route.mode?"onhashchange":"onpopstate";e[a]=function(){var e=de[c.route.mode];"pathname"===c.route.mode&&(e+=de.search),ze!==V(e)&&Xe(e)},qe=ee,e[a]()}else if(t.addEventListener||t.attachEvent)t.href=("pathname"!==c.route.mode?de.pathname:"")+$e[c.route.mode]+i.attrs.href,t.addEventListener?(t.removeEventListener("click",Z),t.addEventListener("click",Z)):(t.detachEvent("onclick",Z),t.attachEvent("onclick",Z));else if(o(t)){var s=ze;ze=t;var u=n||{},l=ze.indexOf("?"),d=l>-1?ne(ze.slice(l+1)):{};for(var f in u)d[f]=u[f];var p=te(d),h=l>-1?ze.slice(0,l):ze;p&&(ze=h+(-1===h.indexOf("?")?"?":"&")+p);var v=(3===arguments.length?r:n)===!0||s===t;e.history.pushState?(qe=ee,Ke=function(){e.history[v?"replaceState":"pushState"](null,le.title,$e[c.route.mode]+ze)},Xe($e[c.route.mode]+ze)):(de[c.route.mode]=ze,Xe($e[c.route.mode]+ze))}},c.route.param=function(e){if(!Ie)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return e?Ie[e]:Ie},c.route.mode="search",c.route.buildQueryString=te,c.route.parseQueryString=ne,c.deferred=function(){var e=new ie;return e.promise=oe(e.promise),e},c.deferred.onerror=function(e){if("[object Error]"===ge.call(e)&&!e.constructor.toString().match(/ Error/))throw We=0,e},c.sync=function(e){function t(e,t){return function(a){return i[e]=a,t||(n="reject"),0===--o&&(r.promise(i),r[n](i)),a}}var n="resolve",r=c.deferred(),o=e.length,i=new Array(o);return e.length>0?s(e,function(e,n){e.then(t(n,!0),t(n,!1))}):r.resolve([]),r.promise},c.request=function(e){e.background!==!0&&c.startComputation();var t=new ie,n=e.dataType&&"jsonp"===e.dataType.toLowerCase(),r=e.serialize=n?ae:e.serialize||JSON.stringify,o=e.deserialize=n?ae:e.deserialize||JSON.parse,i=n?function(e){return e.responseText}:e.extract||function(e){return 0===e.responseText.length&&o===JSON.parse?null:e.responseText};return e.method=(e.method||"GET").toUpperCase(),e.url=ue(e.url,e.data),e=se(e,e.data,r),e.onload=e.onerror=function(n){try{n=n||event;var r=("load"===n.type?e.unwrapSuccess:e.unwrapError)||ae,a=r(o(i(n.target,e)),n.target);"load"===n.type&&(ve(a)&&e.type?s(a,function(t,n){a[n]=new e.type(t)}):e.type&&(a=new e.type(a))),t["load"===n.type?"resolve":"reject"](a)}catch(n){c.deferred.onerror(n),t.reject(n)}e.background!==!0&&c.endComputation()},ce(e),t.promise=oe(t.promise,e.initialValue),t.promise},c.deps=function(t){return a(e=t||e),e},c.deps.factory=i,c}("undefined"!=typeof window?window:{});"object"==typeof n&&null!=n&&n.exports?n.exports=o:"function"==typeof e&&e.amd&&e(function(){return o})},{}],4:[function(e,t,n){function r(e,t,n){var r=n?l.invertKey(e):e;return{key:r,pos:l.key2pos(r),role:t.role,color:t.color}}function o(e,t){return e.role===t.role&&e.color===t.color}function i(e,t){return t.sort(function(t,n){return l.distance(e.pos,t.pos)-l.distance(e.pos,n.pos)})[0]}function a(e,t){var n=t.bounds(),a=n.width/8,c=n.height/8,s={},u=[],d=[],f=[],p=[],h=e.orientation!==t.orientation,v={},g="white"===t.orientation;for(var m in e.pieces){var b=r(m,e.pieces[m],h);v[b.key]=b}for(var y=0;y<l.allKeys.length;y++){var w=l.allKeys[y];if(w!==t.movable.dropped[1]){var k=t.pieces[w],x=v[w];k?x?o(k,x)||(f.push(x),p.push(r(w,k,!1))):p.push(r(w,k,!1)):x&&f.push(x)}}return p.forEach(function(e){var t=i(e,f.filter(l.partial(o,e)));if(t){var n=g?t.pos:e.pos,r=g?e.pos:t.pos,d=[(n[0]-r[0])*a,(r[1]-n[1])*c];s[e.key]=[d,d],u.push(t.key)}}),f.forEach(function(e){e.key===t.movable.dropped[0]||l.containsX(u,e.key)||(t.items?t.items.render(e.pos,e.key):!1)||d.push({piece:e,opacity:1})}),{anims:s,fadings:d}}function c(e,t){return Math.round(e*t)/t}function s(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(0>=t)e.animation.current={},e.render();else{var n=d.easeInOutCubic(t);for(var r in e.animation.current.anims){var o=e.animation.current.anims[r];o[1]=[c(o[0][0]*n,10),c(o[0][1]*n,10)]}for(var i in e.animation.current.fadings)e.animation.current.fadings[i].opacity=c(n,100);e.render(),l.requestAnimationFrame(function(){s(e)})}}}function u(e,t){var n={orientation:t.orientation,pieces:{}};for(var r in t.pieces)n.pieces[r]={role:t.pieces[r].role,color:t.pieces[r].color};var o=e();if(t.animation.enabled){var i=a(n,t);if(Object.keys(i.anims).length>0||i.fadings.length>0){var c=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:i.anims,fadings:i.fadings},c||s(t)}else t.renderRAF()}else t.renderRAF();return o}var l=e("./util"),d={easeInOutCubic:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}};t.exports=function(e,t,n){return function(){var r=[t].concat(Array.prototype.slice.call(arguments,0));if(t.render){if(t.animation.enabled&&!n)return u(l.partialApply(e,r),t);var o=e.apply(null,r);return t.renderRAF(),o}return e.apply(null,r)}}},{"./util":17}],5:[function(e,t,n){var r=e("./board");t.exports=function(e){return{set:e.set,toggleOrientation:e.toggleOrientation,getOrientation:e.getOrientation,getPieces:function(){return e.data.pieces},getMaterialDiff:function(){return r.getMaterialDiff(e.data)},getFen:e.getFen,move:e.apiMove,newPiece:e.apiNewPiece,setPieces:e.setPieces,setCheck:e.setCheck,playPremove:e.playPremove,playPredrop:e.playPredrop,cancelPremove:e.cancelPremove,cancelPredrop:e.cancelPredrop,cancelMove:e.cancelMove,stop:e.stop,explode:e.explode,setAutoShapes:e.setAutoShapes,setShapes:e.setShapes,data:e.data}}},{"./board":6}],6:[function(e,t,n){function r(e){setTimeout(e,1)}function o(e){e.orientation=K.opposite(e.orientation)}function i(e){e.lastMove=null,k(e,null),u(e),d(e)}function a(e,t){Object.keys(t).forEach(function(n){t[n]?e.pieces[n]=t[n]:delete e.pieces[n]}),e.movable.dropped=[]}function c(e,t){var n=t||e.turnColor;Object.keys(e.pieces).forEach(function(t){e.pieces[t].color===n&&"king"===e.pieces[t].role&&(e.check=t)})}function s(e,t,n){d(e),e.premovable.current=[t,n],r(K.partial(e.premovable.events.set,t,n))}function u(e){e.premovable.current&&(e.premovable.current=null,r(e.premovable.events.unset))}function l(e,t,n){u(e),e.predroppable.current={role:t,key:n},r(K.partial(e.predroppable.events.set,t,n))}function d(e){e.predroppable.current.key&&(e.predroppable.current={},r(e.predroppable.events.unset))}function f(e,t,n){if(e.autoCastle){var r=e.pieces[n];if("king"===r.role){var o=K.key2pos(t);if(5===o[0]&&(1===o[1]||8===o[1])){var i,a,c,s=K.key2pos(n);if(7===s[0]||8===s[0])i=K.pos2key([8,o[1]]),a=K.pos2key([6,o[1]]),c=K.pos2key([7,o[1]]);else{if(3!==s[0]&&1!==s[0])return;i=K.pos2key([1,o[1]]),a=K.pos2key([4,o[1]]),c=K.pos2key([3,o[1]])}delete e.pieces[t],delete e.pieces[n],delete e.pieces[i],e.pieces[c]={role:"king",color:r.color},e.pieces[a]={role:"rook",color:r.color}}}}}function p(e,t,n){var o=L(function(){if(t===n||!e.pieces[t])return!1;var o=e.pieces[n]&&e.pieces[n].color!==e.pieces[t].color?e.pieces[n]:null;return r(K.partial(e.events.move,t,n,o)),e.pieces[n]=e.pieces[t],delete e.pieces[t],e.lastMove=[t,n],e.check=null,f(e,t,n),r(e.events.change),!0},e)();return o&&(e.movable.dropped=[]),o}function h(e,t,n){return e.pieces[n]?!1:(r(K.partial(e.events.dropNewPiece,t,n)),e.pieces[n]=t,e.lastMove=[n,n],e.check=null,r(e.events.change),e.movable.dropped=[],e.movable.dests={},e.turnColor=K.opposite(e.turnColor),e.renderRAF(),!0)}function v(e,t,n){var r=p(e,t,n);return r&&(e.movable.dests={},e.turnColor=K.opposite(e.turnColor)),r}function g(e,t,n){return p(e,t,n)}function m(e,t,n){return h(e,t,n)}function b(e,t,n){if(n)if(C(e,t,n)){if(v(e,t,n)){var o=B.stop();return k(e,null),r(K.partial(e.movable.events.after,t,n,{premove:!1,holdTime:o})),!0}}else M(e,t,n)?(s(e,t,n),k(e,null)):x(e,n)||P(e,n)?(k(e,n),B.start()):k(e,null);else B.cancel(),k(e,null),"trash"===e.movable.dropOff&&(delete e.pieces[t],r(e.events.change))}function y(e,t,n){if(E(e,t,n)){var o=e.pieces[t];delete e.pieces[t],h(e,o,n),e.movable.dropped=[],r(K.partial(e.movable.events.afterNewPiece,o.role,n,{predrop:!1}))}else O(e,t,n)?l(e,e.pieces[t].role,n):(u(e),d(e));delete e.pieces[t],k(e,null)}function w(e,t){e.selected?t&&(e.selected!==t||e.draggable.enabled)?e.selectable.enabled&&e.selected!==t?b(e,e.selected,t)&&(e.stats.dragged=!1):B.start():(k(e,null),B.cancel()):(x(e,t)||P(e,t))&&(k(e,t),B.start()),t&&r(K.partial(e.events.select,t))}function k(e,t){e.selected=t,e.premovable.dests=t&&P(e,t)?F(e.pieces,t,e.premovable.castle):null}function x(e,t){var n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function C(e,t,n){return t!==n&&x(e,t)&&(e.movable.free||K.containsX(e.movable.dests[t],n))}function E(e,t,n){var r=e.pieces[t];return r&&n&&(t===n||!e.pieces[n])&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function P(e,t){var n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function M(e,t,n){return t!==n&&P(e,t)&&K.containsX(F(e.pieces,t,e.premovable.castle),n)}function O(e,t,n){var r=e.pieces[t];return r&&n&&(!e.pieces[n]||e.pieces[n].color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===r.color&&e.turnColor!==r.color}function A(e,t){var n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function T(e){var t=e.premovable.current;if(t){var n=t[0],o=t[1],i=!1;return C(e,n,o)&&v(e,n,o)&&(r(K.partial(e.movable.events.after,n,o,{premove:!0})),i=!0),u(e),i}}function N(e,t){var n=e.predroppable.current,o=!1;if(n.key){if(t(n)){var i={role:n.role,color:e.movable.color};h(e,i,n.key)&&(r(K.partial(e.movable.events.afterNewPiece,n.role,n.key,{predrop:!0})),o=!0)}return d(e),o}}function j(e){u(e),d(e),w(e,null)}function S(e){e.movable.color=null,e.movable.dests={},j(e)}function R(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.ceil(8*((t[0]-n.left)/n.width));r="white"===e.orientation?r:9-r;var o=Math.ceil(8-8*((t[1]-n.top)/n.height));return o="white"===e.orientation?o:9-o,r>0&&9>r&&o>0&&9>o?K.pos2key([r,o]):void 0}}function D(e){var t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var n in e.pieces){var r=e.pieces[n];t[r.role]+="white"===r.color?1:-1}var o={white:{},black:{}};for(var i in t){var a=t[i];a>0?o.white[i]=a:0>a&&(o.black[i]=-a)}return o}function q(e){var t=0;for(var n in e.pieces)t+=U[e.pieces[n].role]*("white"===e.pieces[n].color?1:-1);return t}var K=e("./util"),F=e("./premove"),L=e("./anim"),B=e("./hold"),U={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0};t.exports={reset:i,toggleOrientation:o,setPieces:a,setCheck:c,selectSquare:w,setSelected:k,isDraggable:A,canMove:C,userMove:b,dropNewPiece:y,apiMove:g,apiNewPiece:m,playPremove:T,playPredrop:N,unsetPremove:u,unsetPredrop:d,cancelMove:j,stop:S,getKeyAtDomPos:R,getMaterialDiff:D,getScore:q}},{"./anim":4,"./hold":14,"./premove":15,"./util":17}],7:[function(e,t,n){var r=e("merge"),o=e("./board"),i=e("./fen");t.exports=function(e,t){t&&(t.movable&&t.movable.dests&&delete e.movable.dests,r.recursive(e,t),e.fen&&(e.pieces=i.read(e.fen),e.check=t.check,e.drawable.shapes=[],delete e.fen),e.check===!0&&o.setCheck(e),e.movable.dropped=[],e.selected&&o.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<40)&&(e.animation.enabled=!1))}},{"./board":6,"./fen":13,merge:2}],8:[function(e,t,n){function r(e,t,n){var r=document.createElement("coords");return r.className=t,e.forEach(function(e){var t=document.createElement("coord");t.textContent=e,r.appendChild(t)}),r}var o=(e("mithril"),e("./util"));t.exports=function(e,t){o.requestAnimationFrame(function(){var n=document.createDocumentFragment(),i="black"===e?" black":"";n.appendChild(r(o.ranks,"ranks"+i)),n.appendChild(r(o.files,"files"+i)),t.appendChild(n)});var e;return function(n){if(n!==e){e=n;var r=t.querySelectorAll("coords");for(i=0;i<r.length;++i)r[i].classList.toggle("black","black"===n)}}}},{"./util":17,mithril:3}],9:[function(e,t,n){var r=e("./board"),o=e("./data"),i=e("./fen"),a=e("./configure"),c=e("./anim"),s=e("./drag");t.exports=function(e){this.data=o(e),this.vm={exploding:!1},this.getFen=function(){return i.write(this.data.pieces)}.bind(this),this.getOrientation=function(){return this.data.orientation}.bind(this),this.set=c(a,this.data),this.toggleOrientation=function(){c(r.toggleOrientation,this.data)(),this.data.redrawCoords&&this.data.redrawCoords(this.data.orientation)},this.setPieces=c(r.setPieces,this.data),this.selectSquare=c(r.selectSquare,this.data,!0),this.apiMove=c(r.apiMove,this.data),this.apiNewPiece=c(r.apiNewPiece,this.data),this.playPremove=c(r.playPremove,this.data),this.playPredrop=c(r.playPredrop,this.data),this.cancelPremove=c(r.unsetPremove,this.data,!0),this.cancelPredrop=c(r.unsetPredrop,this.data,!0),this.setCheck=c(r.setCheck,this.data,!0),this.cancelMove=c(function(e){r.cancelMove(e),s.cancel(e)}.bind(this),this.data,!0),this.stop=c(function(e){r.stop(e),s.cancel(e)}.bind(this),this.data,!0),this.explode=function(e){this.data.render&&(this.vm.exploding={stage:1,keys:e},this.data.renderRAF(),setTimeout(function(){this.vm.exploding.stage=2,this.data.renderRAF(),
setTimeout(function(){this.vm.exploding=!1,this.data.renderRAF()}.bind(this),120)}.bind(this),120))}.bind(this),this.setAutoShapes=function(e){c(function(t){t.drawable.autoShapes=e},this.data,!1)()}.bind(this),this.setShapes=function(e){c(function(t){t.drawable.shapes=e},this.data,!1)()}.bind(this)}},{"./anim":4,"./board":6,"./configure":7,"./data":10,"./drag":11,"./fen":13}],10:[function(e,t,n){var r=e("./fen"),o=e("./configure");t.exports=function(e){var t={pieces:r.read(r.initial),orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,render:null,renderRAF:null,element:null,bounds:null,autoCastle:!1,viewOnly:!1,disableContextMenu:!1,resizable:!0,pieceKey:!1,highlight:{lastMove:!0,check:!0,dragOver:!0},animation:{enabled:!0,duration:200,current:{}},movable:{free:!0,color:"both",dests:{},dropOff:"revert",dropped:[],showDests:!0,events:{after:function(e,t,n){},afterNewPiece:function(e,t){}}},premovable:{enabled:!0,showDests:!0,castle:!0,dests:[],current:null,events:{set:function(e,t){},unset:function(){}}},predroppable:{enabled:!1,current:{},events:{set:function(e,t){},unset:function(){}}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,current:{}},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{change:function(){},move:function(e,t,n){},dropNewPiece:function(e,t){},capture:function(e,t){},select:function(e){}},items:null,drawable:{enabled:!1,eraseOnClick:!0,onChange:function(e){},shapes:[],autoShapes:[],current:{},brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"}}};return o(t,e||{}),t}},{"./configure":7,"./fen":13}],11:[function(e,t,n){function r(e){return e?e.color+e.role:""}function o(e,t,n){var r=f.key2pos(n);return"white"!==e.orientation&&(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}function i(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),l=t.target;var n=e.selected,i=f.eventPosition(t),c=e.bounds(),s=d.getKeyAtDomPos(e,i,c),u=e.pieces[s];if(n||!e.drawable.eraseOnClick&&u&&u.color===e.turnColor||p.clear(e),!e.viewOnly){var h=!!e.premovable.current,v=!!e.predroppable.current.key;d.selectSquare(e,s);var g=e.selected===s;if(u&&g&&d.isDraggable(e,s)){var m=o(e,c,s);e.draggable.current={previouslySelected:n,orig:s,piece:r(u),rel:i,epos:i,pos:[0,0],dec:e.draggable.centerPiece?[i[0]-(m.left+m.width/2),i[1]-(m.top+m.height/2)]:[0,0],bounds:c,started:e.draggable.autoDistance&&e.stats.dragged}}else h&&d.unsetPremove(e),v&&d.unsetPredrop(e);a(e)}}}function a(e){f.requestAnimationFrame(function(){var t=e.draggable.current;t.orig&&(e.animation.current.start&&e.animation.current.anims[t.orig]&&(e.animation.current={}),r(e.pieces[t.orig])!==t.piece?u(e):(!t.started&&f.distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=d.getKeyAtDomPos(e,t.epos,t.bounds)))),e.render(),t.orig&&a(e)})}function c(e,t){t.touches&&t.touches.length>1||e.draggable.current.orig&&(e.draggable.current.epos=f.eventPosition(t))}function s(e,t){var n=e.draggable.current,r=n?n.orig:null;if(r){if("touchend"===t.type&&l!==t.target&&!n.newPiece)return void(e.draggable.current={});d.unsetPremove(e),d.unsetPredrop(e);var o=f.eventPosition(t),i=o?d.getKeyAtDomPos(e,o,n.bounds):n.over;n.started&&(n.newPiece?d.dropNewPiece(e,r,i):(r!==i&&(e.movable.dropped=[r,i]),d.userMove(e,r,i)&&(e.stats.dragged=!0))),r!==n.previouslySelected||r!==i&&i?e.selectable.enabled||d.setSelected(e,null):d.setSelected(e,null),e.draggable.current={}}}function u(e){e.draggable.current.orig&&(e.draggable.current={},d.selectSquare(e,null))}var l,d=e("./board"),f=e("./util"),p=e("./draw");t.exports={start:i,move:c,end:s,cancel:u,processDrag:a}},{"./board":6,"./draw":12,"./util":17}],12:[function(e,t,n){function r(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),p.cancelMove(e);var n=h.eventPosition(t),r=e.bounds(),i=p.getKeyAtDomPos(e,n,r);e.drawable.current={orig:i,epos:n,bounds:r,brush:v[(t.shiftKey&h.isRightButton(t))+(t.altKey?2:0)]},o(e)}}function o(e){h.requestAnimationFrame(function(){var t=e.drawable.current;if(t.orig){var n=p.getKeyAtDomPos(e,t.epos,t.bounds);t.dest=t.orig===n?void 0:n}e.render(),t.orig&&o(e)})}function i(e,t){e.drawable.current.orig&&(e.drawable.current.epos=h.eventPosition(t))}function a(e,t){var n=e.drawable,r=n.current.orig,o=n.current.dest;r&&o?d(n,r,o):r&&l(n,r),n.current={},e.render()}function c(e){e.drawable.current.orig&&(e.drawable.current={})}function s(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.render(),f(e.drawable))}function u(e){return function(t){return!e(t)}}function l(e,t){var n=e.current.brush,r=function(e){return e.orig===t&&!e.dest},o=e.shapes.filter(r)[0];o&&(e.shapes=e.shapes.filter(u(r))),o&&o.brush===n||e.shapes.push({brush:n,orig:t}),f(e)}function d(e,t,n){var r=e.current.brush,o=function(e){return e.orig&&e.dest&&(e.orig===t&&e.dest===n||e.dest===t&&e.orig===n)},i=e.shapes.filter(o).length>0;i?e.shapes=e.shapes.filter(u(o)):e.shapes.push({brush:r,orig:t,dest:n}),f(e)}function f(e){e.onChange(e.shapes)}var p=e("./board"),h=e("./util"),v=["green","red","blue","yellow"];t.exports={start:r,move:i,end:a,cancel:c,clear:s,processDraw:o}},{"./board":6,"./util":17}],13:[function(e,t,n){function r(e){"start"===e&&(e=a);var t={};return e.replace(/ .+$/,"").replace(/~/g,"").split("/").forEach(function(e,n){var r=0;e.split("").forEach(function(e){var o=parseInt(e);o?r+=o:(r++,t[i.pos2key([r,8-n])]={role:c[e.toLowerCase()],color:e===e.toLowerCase()?"black":"white"})})}),t}function o(e){return[8,7,6,5,4,3,2].reduce(function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),t)},i.invRanks.map(function(t){return i.ranks.map(function(n){var r=e[i.pos2key([n,t])];if(r){var o=s[r.role];return"white"===r.color?o.toUpperCase():o}return"1"}).join("")}).join("/"))}var i=e("./util"),a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",c={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},s={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};t.exports={initial:a,read:r,write:o}},{"./util":17}],14:[function(e,t,n){var r,o=function(){r=new Date},i=function(){r=null},a=function(){if(!r)return 0;var e=new Date-r;return r=null,e};t.exports={start:o,cancel:i,stop:a}},{}],15:[function(e,t,n){function r(e,t){return Math.abs(e-t)}function o(e,t,n,o,i){return r(t,o)<2&&("white"===e?i===n+1||2>=n&&i===n+2&&t===o:i===n-1||n>=7&&i===n-2&&t===o)}function i(e,t,n,o){var i=r(e,n),a=r(t,o);return 1===i&&2===a||2===i&&1===a}function a(e,t,n,o){return r(e,n)===r(t,o)}function c(e,t,n,r){return e===n||t===r}function s(e,t,n,r){return a(e,t,n,r)||c(e,t,n,r)}function u(e,t,n,o,i,a,c){return r(o,a)<2&&r(i,c)<2||n&&i===c&&i===("white"===e?1:8)&&(5===o&&(3===a||7===a)||f.containsX(t,a))}function l(e,t){return Object.keys(e).filter(function(n){var r=e[n];return r&&r.color===t&&"rook"===r.role}).map(function(e){return f.key2pos(e)[0]})}function d(e,t,n){var r,d=e[t],p=f.key2pos(t);switch(d.role){case"pawn":r=o.bind(null,d.color);break;case"knight":r=i;break;case"bishop":r=a;break;case"rook":r=c;break;case"queen":r=s;break;case"king":r=u.bind(null,d.color,l(e,d.color),n)}return f.allPos.filter(function(e){return(p[0]!==e[0]||p[1]!==e[1])&&r(p[0],p[1],e[0],e[1])}).map(f.pos2key)}var f=e("./util");t.exports=d},{"./util":17}],16:[function(e,t,n){function r(e,t){return(e?3:4)/512*t.width}function o(e,t,n){return(e.lineWidth||10)*(t?.85:1)/512*n.width}function i(e,t){return(e.opacity||1)*(t?.9:1)}function a(e,t){return m()?0:(e?10:20)/512*t.width}function c(e,t){var n=t.width/8;return[(e[0]-.5)*n,(8.5-e[1])*n]}function s(e,t,n,o){var a=c(t,o),s=r(n,o),u=o.width/16;return{tag:"circle",attrs:{key:n?"current":t+e.key,stroke:e.color,"stroke-width":s,fill:"none",opacity:i(e,n),cx:a[0],cy:a[1],r:u-s/2}}}function u(e,t,n,r,s){var u=a(r,s),l=c(t,s),d=c(n,s),f=d[0]-l[0],p=d[1]-l[1],h=Math.atan2(p,f),v=Math.cos(h)*u,g=Math.sin(h)*u;return{tag:"line",attrs:{key:r?"current":t+n+e.key,stroke:e.color,"stroke-width":o(e,r,s),"stroke-linecap":"round","marker-end":m()?null:"url(#arrowhead-"+e.key+")",opacity:i(e,r),x1:l[0],y1:l[1],x2:d[0]-v,y2:d[1]-g}}}function l(e,t,n,r){var o=c(t,r),i=r.width/8*(n.scale||1),a="white"===n.color?"w":"b";a+=("knight"===n.role?"n":n.role[0]).toUpperCase();var s=e.baseUrl+a+".svg";return{tag:"image",attrs:{"class":n.color+" "+n.role,x:o[0]-i/2,y:o[1]-i/2,width:i,height:i,href:s}}}function d(e){return{tag:"defs",children:[e.map(function(e){return{key:e.key,tag:"marker",attrs:{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01},children:[{tag:"path",attrs:{d:"M0,0 V4 L3,2 Z",fill:e.color}}]}})]}}function f(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function p(e,t,n){return function(r,o){if(r.piece)return l(e.drawable.pieces,f(g(r.orig),e.orientation),r.piece,n);if(r.brush){var i=r.brushModifiers?h(e.drawable.brushes[r.brush],r.brushModifiers,o):e.drawable.brushes[r.brush],a=f(g(r.orig),e.orientation);if(r.orig&&r.dest)return u(i,a,f(g(r.dest),e.orientation),t,n);if(r.orig)return s(i,a,t,n)}}}function h(e,t,n){return{key:"bm"+n,color:t.color||e.color,opacity:t.opacity||e.opacity,lineWidth:t.lineWidth||e.lineWidth}}function v(e,t,n){var r=[],o=[],i=n&&n.dest?t.concat(n):t;for(var a in i){var c=i[a];if(c.dest){var s=c.brush;c.brushModifiers?r.push(h(e.brushes[s],c.brushModifiers,a)):-1===o.indexOf(s)&&(r.push(e.brushes[s]),o.push(s))}}return r}var g=(e("mithril"),e("./util").key2pos),m=e("./util").isTrident;t.exports=function(e){if(e.data.bounds){var t=e.data.drawable,n=t.shapes.concat(t.autoShapes);if(n.length||t.current.orig){var r=e.data.bounds();if(r.width===r.height){var o=v(t,n,t.current);return{tag:"svg",attrs:{key:"svg"},children:[d(o),n.map(p(e.data,!1,r)),p(e.data,!0,r)(t.current,9999)]}}}}}},{"./util":17,mithril:3}],17:[function(e,t,n){function r(e){return w[e[0]-1]+e[1]}function o(e){return[C[e[0]],parseInt(e[1])]}function i(e){return w[8-C[e[0]]]+(9-parseInt(e[1]))}function a(e){var t=[];for(var n in e)e[n]&&t.push(n);return t.join(" ")}function c(e){return"white"===e?"black":"white"}function s(e,t){return e&&-1!==e.indexOf(t)}function u(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function l(){return"transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"}function d(){return y||(y=l()),y}function f(){return null===O&&(O=window.navigator.userAgent.indexOf("Trident/")>-1),O}function p(e){return"translate("+e[0]+"px,"+e[1]+"px)"}function h(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0}function v(e,t){return e.bind.apply(e,[null].concat(t))}function g(){return v(arguments[0],Array.prototype.slice.call(arguments,1))}function m(e){return 2===e.buttons||2===e.button}function b(e){var t,n=function(){return void 0===t&&(t=e()),t};return n.clear=function(){t=void 0},n}var y,w="abcdefgh".split(""),k=[1,2,3,4,5,6,7,8],x=[8,7,6,5,4,3,2,1],C={a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8},E=function(){var e=[];return x.forEach(function(t){k.forEach(function(n){e.push([n,t])})}),e}(),P=E.map(r),M=P.slice(0).reverse(),O=null;t.exports={files:w,ranks:k,invRanks:x,allPos:E,allKeys:P,invKeys:M,pos2key:r,key2pos:o,invertKey:i,classSet:a,opposite:c,translate:p,containsX:s,distance:u,eventPosition:h,partialApply:v,partial:g,transformProp:d,isTrident:f,requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),isRightButton:m,memo:b}},{}],18:[function(e,t,n){function r(e){return e.role+" "+e.color}function o(e,t,n){var o={key:"p"+t,style:{},"class":r(e.pieces[t])},i=a(b.key2pos(t),n),c=e.draggable.current;if(c.orig===t&&c.started)i[0]+=c.pos[0]+c.dec[0],i[1]+=c.pos[1]+c.dec[1],o["class"]+=" dragging";else if(e.animation.current.anims){var s=e.animation.current.anims[t];s&&(i[0]+=s[1][0],i[1]+=s[1][1])}return o.style[n.transformProp]=b.translate(i),e.pieceKey&&(o["data-key"]=t),{tag:x,attrs:o}}function i(e,t,n){var r={key:"s"+e,"class":t,style:{}};return r.style[n.transformProp]=b.translate(a(b.key2pos(e),n)),{tag:C,attrs:r}}function a(e,t){return[(t.asWhite?e[0]-1:8-e[0])*t.bounds.width/8,(t.asWhite?8-e[1]:e[1]-1)*t.bounds.height/8]}function c(e,t,n){if(t){var o={key:"g"+e,style:{},"class":r(t)+" ghost"};return o.style[n.transformProp]=b.translate(a(b.key2pos(e),n)),{tag:x,attrs:o}}}function s(e,t){var n={key:"f"+e.piece.key,"class":"fading "+r(e.piece),style:{opacity:e.opacity}};return n.style[t.transformProp]=b.translate(a(e.piece.pos,t)),{tag:x,attrs:n}}function u(e,t,n){e[t]?e[t].push(n):e[t]=[n]}function l(e,t){var n=e.data,r={};if(n.lastMove&&n.highlight.lastMove&&n.lastMove.forEach(function(e){u(r,e,"last-move")}),n.check&&n.highlight.check&&u(r,n.check,"check"),n.selected){u(r,n.selected,"selected");var o=n.draggable.current.over,a=n.movable.dests[n.selected];a&&a.forEach(function(e){e===o?u(r,e,"move-dest drag-over"):n.movable.showDests&&u(r,e,"move-dest"+(n.pieces[e]?" oc":""))});var c=n.premovable.dests;c&&c.forEach(function(e){e===o?u(r,e,"premove-dest drag-over"):n.movable.showDests&&u(r,e,"premove-dest"+(n.pieces[e]?" oc":""))})}var s=n.premovable.current;s?s.forEach(function(e){u(r,e,"current-premove")}):n.predroppable.current.key&&u(r,n.predroppable.current.key,"current-premove"),e.vm.exploding&&e.vm.exploding.keys.forEach(function(t){u(r,t,"exploding"+e.vm.exploding.stage)});var l=[];if(n.items)for(var d=0;64>d;d++){var f=b.allKeys[d],p=r[f],h=n.items.render(b.key2pos(f),f);if(p||h){var v=i(f,p?p.join(" ")+(h?" has-item":""):"has-item",t);h&&(v.children=[h]),l.push(v)}}else for(var f in r)l.push(i(f,r[f].join(" "),t));return l}function d(e){var t=e.data;if(t.bounds){var n={asWhite:"white"===t.orientation,bounds:t.bounds(),transformProp:b.transformProp()},r=l(e,n);t.animation.current.fadings&&t.animation.current.fadings.forEach(function(e){r.push(s(e,n))});var i=n.asWhite?b.allKeys:b.invKeys;if(t.items)for(var a=0;64>a;a++)t.pieces[i[a]]&&!t.items.render(b.key2pos(i[a]),i[a])&&r.push(o(t,i[a],n));else for(var a=0;64>a;a++)t.pieces[i[a]]&&r.push(o(t,i[a],n));if(t.draggable.showGhost){var u=t.draggable.current.orig;u&&!t.draggable.current.newPiece&&r.push(c(u,t.pieces[u],n))}return t.drawable.enabled&&r.push(y(e)),r}}function f(e){return function(t){b.isRightButton(t)&&e.draggable.current.orig?(e.draggable.current.newPiece&&delete e.pieces[e.draggable.current.orig],e.draggable.current={},e.selected=null):(t.shiftKey||b.isRightButton(t))&&e.drawable.enabled?m.start(e,t):g.start(e,t)}}function p(e,t,n){return function(r){(r.shiftKey||b.isRightButton(r))&&e.drawable.enabled?n(e,r):e.viewOnly||t(e,r)}}function h(e,t,n){var r=e.data,o=f(r),i=p(r,g.move,m.move),a=p(r,g.end,m.end),c=["touchstart","mousedown"],s=["touchmove","mousemove"],u=["touchend","mouseup"];c.forEach(function(e){t.addEventListener(e,o)}),s.forEach(function(e){document.addEventListener(e,i)}),u.forEach(function(e){document.addEventListener(e,a)}),n.onunload=function(){c.forEach(function(e){t.removeEventListener(e,o)}),s.forEach(function(e){document.removeEventListener(e,i)}),u.forEach(function(e){document.removeEventListener(e,a)})}}function v(e){var t=e.data;return{tag:"div",attrs:{"class":"cg-board orientation-"+t.orientation,config:function(n,r,o){r||((!t.viewOnly||t.drawable.enabled)&&h(e,n,o),t.render=function(){k.render(n,d(e))},t.renderRAF=function(){b.requestAnimationFrame(t.render)},t.bounds=b.memo(n.getBoundingClientRect.bind(n)),t.element=n,t.render())}},children:[]}}var g=e("./drag"),m=e("./draw"),b=e("./util"),y=e("./svg"),w=e("./coords"),k=e("mithril"),x="piece",C="square";t.exports=function(e){var t=e.data;return{tag:"div",attrs:{config:function(e,n){return n?void(t.redrawCoords&&t.redrawCoords(t.orientation)):(t.coordinates&&(t.redrawCoords=w(t.orientation,e)),e.addEventListener("contextmenu",function(e){return t.disableContextMenu||t.drawable.enabled?(e.preventDefault(),!1):void 0}),t.resizable&&document.body.addEventListener("chessground.resize",function(e){t.bounds.clear(),t.render()},!1),void["onscroll","onresize"].forEach(function(e){var n=window[e];window[e]=function(){n&&n(),t.bounds.clear()}}))},"class":["cg-board-wrap",t.viewOnly?"view-only":"manipulable"].join(" ")},children:[v(e)]}}},{"./coords":8,"./drag":11,"./draw":12,"./svg":16,"./util":17,mithril:3}]},{},[1])(1)});